(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(e){var i=function(e){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(i)?i:i+""}function n(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function o(t,e){return t.get(a(t,e))}function r(t,e,i){return t.set(a(t,e),i),i}function a(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var s=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,y=new WeakMap,m=new WeakMap,p=new WeakMap,d=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,s,void 0),n(this,h,void 0),n(this,l,void 0),n(this,u,void 0),n(this,c,void 0),n(this,f,void 0),n(this,y,void 0),n(this,m,void 0),n(this,p,void 0),r(s,this,e),r(h,this,i),r(l,this,void 0),r(u,this,0),r(c,this,0),r(f,this,!1),r(y,this,0),r(m,this,0),r(p,this,"...")},(i=[{key:"setAssetsLoadedCount",value:function(t){r(m,this,t)}},{key:"setAssetsLimitCount",value:function(t){r(y,this,t)}},{key:"setLoadedAssetsText",value:function(t){r(p,this,t)}},{key:"complete",value:function(){var t=this;r(f,this,!0),setTimeout((function(){return t.stop()}),500)}},{key:"start",value:function(){var t=this,e=Array(parseInt(o(c,this))).fill(".").join(""),i="Đang tải".concat(e),n=o(s,this),a=n.width,d=n.height;o(c,this)>4&&r(c,this,0),r(c,this,o(c,this)+.1),o(h,this).fillStyle="rgb(0, 0, 0)",o(h,this).fillRect(0,0,a,d),o(h,this).save(),o(h,this).translate(a/2,d/2+70),o(h,this).rotate(o(u,this));for(var v=0;v<16;v++)o(h,this).beginPath(),o(h,this).rotate(2*Math.PI/16),o(h,this).moveTo(12,0),o(h,this).lineTo(30,0),o(h,this).lineWidth=2,o(h,this).strokeStyle="rgba(255, 255, 255, ".concat(v/16,")"),o(h,this).stroke();o(h,this).restore(),o(h,this).font="35px Arial",o(h,this).textAlign="center",o(h,this).textBaseline="middle",o(h,this).fillStyle="white",o(h,this).fillText(i,a/2,d/2),o(h,this).font="20px Arial",o(h,this).textAlign="right",o(h,this).textBaseline="bottom",o(h,this).fillStyle="white",o(h,this).fillText(o(f,this)?"Tải hoàn tất":"Đã tải: ".concat(o(p,this)," (").concat(o(m,this),"/").concat(o(y,this),")"),.97*a,.97*d),r(u,this,o(u,this)+.04),r(l,this,requestAnimationFrame((function(){return t.start()})))}},{key:"stop",value:function(){var t=o(s,this),e=t.width,i=t.height;cancelAnimationFrame(o(l,this)),o(h,this).clearRect(0,0,e,i)}}])&&e(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function g(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=v(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}function b(t,e,i){k(t,e),e.set(t,i)}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function x(t,e,i){return t.set(M(t,e),i),i}function S(t,e){return t.get(M(t,e))}function M(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var I=new WeakMap,P=new WeakMap,E=new WeakMap,j=new WeakMap,W=new WeakSet,T=function(){return t=function t(e){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,i=W),i.add(this),b(this,I,{images:{}}),b(this,P,0),b(this,E,0),b(this,j,void 0),this.assetLoadingInterface=e},(e=[{key:"loadImage",value:function(t,e){var i,n=this;x(P,this,(i=S(P,this),++i)),this.assetLoadingInterface.setAssetsLimitCount(S(P,this));var o=new Image;o.src=e,o.onload=function(){return M(W,n,C).call(n,t,o)}}},{key:"getImage",value:function(t){var e=S(I,this).images[t];return e||console.warn('Hình ảnh với tên "'.concat(t,'" không tồn tại')),e}},{key:"onAllAssetsLoaded",value:function(t){x(j,this,t)}}])&&w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t,e){var i;S(I,this).images[t]&&console.warn('Hình ảnh với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),S(I,this).images[t]=e,x(E,this,(i=S(E,this),++i)),this.assetLoadingInterface.setLoadedAssetsText(t),this.assetLoadingInterface.setAssetsLoadedCount(S(E,this)),S(E,this)===S(P,this)&&S(j,this)&&S(j,this).call(this)}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function z(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,L(n.key),n)}}function L(t){var e=function(t){if("object"!=A(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=A(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}function R(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function O(t,e){return t.get(B(t,e))}function H(t,e,i){return t.set(B(t,e),i),i}function B(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var D=new WeakMap,q=new WeakMap,F=new WeakMap,Y=new WeakMap,X=new WeakMap,K=new WeakMap,G=new WeakMap,U=new WeakMap,J=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,D,void 0),R(this,q,void 0),R(this,F,void 0),R(this,Y,void 0),R(this,X,void 0),R(this,K,void 0),R(this,G,void 0),R(this,U,void 0),H(D,this,0),H(q,this,0),H(F,this,0),H(Y,this,0),H(X,this,0),H(K,this,0),H(G,this,null)},e=[{key:"withLocation",value:function(t,e){return H(D,this,t),H(q,this,e),this}},{key:"withAngle",value:function(t){return H(F,this,t),this}},{key:"withSpeed",value:function(t){return H(Y,this,t),this}},{key:"withSize",value:function(t,e){return H(X,this,t),H(K,this,e),this}},{key:"withImage",value:function(t){return H(G,this,t),this}},{key:"withCollisionImage",value:function(t){return H(U,this,t),this}},{key:"x",get:function(){return O(D,this)}},{key:"y",get:function(){return O(q,this)}},{key:"angle",get:function(){return O(F,this)}},{key:"speed",get:function(){return O(Y,this)}},{key:"width",get:function(){return O(X,this)}},{key:"height",get:function(){return O(K,this)}},{key:"image",get:function(){return O(G,this)}},{key:"collisionImage",get:function(){return O(U,this)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H(D,this,O(D,this)+Math.cos(O(F,this))*O(Y,this)),H(q,this,O(q,this)+Math.sin(O(F,this))*O(Y,this)),t.save(),t.translate(O(D,this),O(q,this)),t.rotate(O(F,this)),t.drawImage(O(G,this),-O(X,this)/2,-O(K,this)/2,O(X,this),O(K,this)),t.restore(),e&&(t.save(),t.translate(O(D,this),O(q,this)),t.rotate(O(F,this)),t.strokeStyle="blue",t.strokeRect(-O(X,this)/2,-O(K,this)/2,O(X,this),O(K,this)),t.restore())}}],e&&z(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function Q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,V(n.key),n)}}function V(t){var e=function(t){if("object"!=N(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=N(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==N(e)?e:e+""}var Z=function(){return t=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.duration=i,this.startTime=Date.now(),this.image=n,this.maxWidth=o,this.maxHeight=r,this.radius=10,this.calculateCollisionPoint(e)},(e=[{key:"calculateCollisionPoint",value:function(t){var e=t.angle,i=t.width/2,n=t.height/2,o=Math.cos(e)*i,r=Math.sin(e)*n;this.collisionX=t.x+o,this.collisionY=t.y+r}},{key:"isExpired",value:function(){return Date.now()-this.startTime>this.duration}},{key:"draw",value:function(t){if(!this.isExpired()){var e,i=(Date.now()-this.startTime)/this.duration,n=1+.5*i;if(e=i<=.45?1:1-(i-.45)/.55,t.save(),t.globalAlpha=e,t.translate(this.collisionX,this.collisionY),t.scale(n,n),t.translate(-this.collisionX,-this.collisionY),this.image){var o=this.image.width/this.image.height,r=this.image.width,a=this.image.height;r>this.maxWidth&&(a=(r=this.maxWidth)/o),a>this.maxHeight&&(r=(a=this.maxHeight)*o),t.drawImage(this.image,this.collisionX-r/2,this.collisionY-a/2,r,a)}else t.fillStyle="red",t.beginPath(),t.arc(this.collisionX,this.collisionY,this.radius,0,2*Math.PI),t.fill();t.restore()}}}])&&Q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tt(n.key),n)}}function tt(t){var e=function(t){if("object"!=$(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=$(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$(e)?e:e+""}function et(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function it(t,e){return t.get(ot(t,e))}function nt(t,e,i){return t.set(ot(t,e),i),i}function ot(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var rt=new WeakMap,at=new WeakMap,st=new WeakMap,ht=new WeakMap,lt=new WeakMap,ut=new WeakMap,ct=function(){return t=function t(e){var i=e.x,n=e.y,o=e.width,r=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),et(this,rt,void 0),et(this,at,void 0),et(this,st,void 0),et(this,ht,void 0),et(this,lt,void 0),et(this,ut,void 0),nt(rt,this,i),nt(at,this,n),nt(st,this,o),nt(ht,this,r)},(e=[{key:"x",get:function(){return it(rt,this)}},{key:"y",get:function(){return it(at,this)}},{key:"width",get:function(){return it(st,this)}},{key:"height",get:function(){return it(ht,this)}},{key:"mapWidth",get:function(){return it(lt,this)}},{key:"mapHeight",get:function(){return it(ut,this)}},{key:"setSize",value:function(t){var e=t.width,i=t.height;nt(st,this,e),nt(ht,this,i)}},{key:"setMapSize",value:function(t){var e=t.width,i=t.height;nt(lt,this,e),nt(ut,this,i)}},{key:"update",value:function(t,e){nt(rt,this,t-it(st,this)/2),nt(at,this,e-it(ht,this)/2),this.clamp()}},{key:"apply",value:function(t){t.translate(-it(rt,this),-it(at,this))}},{key:"clamp",value:function(){nt(rt,this,Math.max(0,Math.min(it(rt,this),it(lt,this)-it(st,this)))),nt(at,this,Math.max(0,Math.min(it(at,this),it(ut,this)-it(ht,this))))}}])&&_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function yt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mt(n.key),n)}}function mt(t){var e=function(t){if("object"!=ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ft(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ft(e)?e:e+""}function pt(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function dt(t,e){return t.get(wt(t,e))}function vt(t,e,i){return t.set(wt(t,e),i),i}function wt(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var gt=new WeakMap,bt=new WeakMap,kt=function(){return t=function t(e){var i=e.location,n=i.x,o=i.y,r=e.display,a=r.width,s=r.height,h=r.color;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),pt(this,gt,void 0),pt(this,bt,void 0),vt(gt,this,{x:n,y:o}),vt(bt,this,{width:a,height:s,color:null!=h?h:"black"})},(e=[{key:"x",get:function(){return dt(gt,this).x}},{key:"y",get:function(){return dt(gt,this).y}},{key:"width",get:function(){return dt(bt,this).width}},{key:"height",get:function(){return dt(bt,this).height}},{key:"draw",value:function(t){var e=dt(gt,this),i=e.x,n=e.y,o=dt(bt,this),r=o.width,a=o.height,s=o.color;t.save(),t.fillStyle=s,t.fillRect(i,n,r,a),t.restore()}}])&&yt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function St(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Mt(n.key),n)}}function Mt(t){var e=function(t){if("object"!=xt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=xt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xt(e)?e:e+""}function It(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function Pt(t,e,i){return t.set(jt(t,e),i),i}function Et(t,e){return t.get(jt(t,e))}function jt(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Wt=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,At=function(){return t=function t(e,i,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),It(this,Wt,{width:0,height:0}),It(this,Tt,void 0),It(this,Ct,[]),Object.assign(Et(Wt,this),{width:e,height:i}),Pt(Ct,this,n),Pt(Tt,this,o)},(e=[{key:"walls",get:function(){return Et(Ct,this)}},{key:"size",get:function(){return Et(Wt,this)}},{key:"backgroundImage",get:function(){return Et(Tt,this)}},{key:"draw",value:function(t){Et(Ct,this).forEach((function(e){return e.draw(t)}))}}])&&St(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Lt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rt(n.key),n)}}function Rt(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=zt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}function Ot(t,e,i){Ht(t,e),e.set(t,i)}function Ht(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Bt(t,e){return t.get(Dt(t,e))}function Dt(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var qt=new WeakMap,Ft=new WeakMap,Yt=new WeakSet,Xt=function(){return t=function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ht(this,e=Yt),e.add(this),Ot(this,qt,{"Demo map":{size:{width:2e3,height:2e3},walls:[{x:500,y:500,width:100,height:300},{x:800,y:200,width:200,height:100},{x:1e3,y:700,width:300,height:100},{x:200,y:800,width:100,height:400}]},"01":{originalSize:{width:2560,height:1940},size:{width:2048,height:1552},walls:[],obstacles:[]}}),Ot(this,Ft,{}),Dt(Yt,this,Kt).call(this)},(e=[{key:"getMap",value:function(t){return Bt(Ft,this)[t]}}])&&Lt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Kt(){var t=Bt(qt,this);for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var i=t[e],n=i.size,o=n.width,r=n.height,a=i.walls;Bt(Ft,this)[e]=new At(o,r,a.map((function(t){var e=t.x,i=t.y,n=t.width,o=t.height,r=t.color;return new kt({location:{x:e,y:i},display:{width:n,height:o,color:r}})})))}}const Gt=function(t){return(t%360+360)%360};function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Jt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nt(n.key),n)}}function Nt(t){var e=function(t){if("object"!=Ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Ut(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}function Qt(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function Vt(t,e,i){return t.set($t(t,e),i),i}function Zt(t,e){return t.get($t(t,e))}function $t(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var _t=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ne=new WeakMap,oe=new WeakMap,re=new WeakMap,ae=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qt(this,_t,!1),Qt(this,te,{x:0,y:0}),Qt(this,ee,{radius:80,rotate:0,headRotate:0,width:160,height:160}),Qt(this,ie,{headImage:void 0,bodyImage:void 0,bulletImage:void 0,collisionImage:null}),Qt(this,ne,{hp:0,maxHp:0,atk:0,pen:0,armor:0,speed:0,bulletRange:0,bulletSpeed:0}),Qt(this,oe,{}),Qt(this,re,Date.now())},e=[{key:"dead",get:function(){return Zt(_t,this)},set:function(t){Vt(_t,this,t),Zt(_t,this)||(this.currentHP=this.maxHP)}},{key:"currentHP",get:function(){return Zt(ne,this).hp},set:function(t){Zt(ne,this).hp=t}},{key:"maxHP",get:function(){return Zt(ne,this).maxHp},set:function(t){Zt(ne,this).maxHp=t}},{key:"x",get:function(){return Zt(te,this).x},set:function(t){Zt(te,this).x=t}},{key:"y",get:function(){return Zt(te,this).y},set:function(t){Zt(te,this).y=t}},{key:"radius",get:function(){return Zt(ee,this).radius}},{key:"speed",get:function(){return Zt(ne,this).speed}},{key:"bulletImage",get:function(){return Zt(ie,this).bulletImage}},{key:"collisionImage",get:function(){return Zt(ie,this).collisionImage}},{key:"rotate",get:function(){return Zt(ee,this).rotate},set:function(t){Zt(ee,this).rotate=t}},{key:"headRotate",get:function(){return Zt(ee,this).headRotate},set:function(t){Zt(ee,this).headRotate=t}},{key:"atk",get:function(){return Zt(ne,this).atk}},{key:"setKeyPressedState",value:function(t,e){Zt(oe,this)[t]=e}},{key:"withLocation",value:function(t,e){return Vt(te,this,{x:t,y:e}),this}},{key:"withDisplay",value:function(t,e,i){return Vt(ee,this,{radius:t,rotate:e,headRotate:i}),Zt(ee,this).width=2*t,Zt(ee,this).height=2*t,this}},{key:"withTankImage",value:function(t){var e=t.headImage,i=t.bodyImage,n=t.bulletImage,o=t.collisionImage;return Vt(ie,this,{headImage:e,bodyImage:i,bulletImage:n,collisionImage:o}),this}},{key:"withStats",value:function(t){var e=t.hp,i=t.atk,n=t.pen,o=t.armor,r=t.speed,a=t.bulletRange,s=t.bulletSpeed;return Vt(ne,this,{hp:e,maxHp:e,atk:i,pen:n,armor:o,speed:r,bulletRange:a,bulletSpeed:s}),this}},{key:"move",value:function(t){var e=Date.now(),i=Zt(ne,this).speed,n=Zt(oe,this);Vt(re,this,e);var o=0,r=0;(n.w||n.ArrowUp)&&(r-=1),(n.a||n.ArrowLeft)&&(o-=1),(n.s||n.ArrowDown)&&(r+=1),(n.d||n.ArrowRight)&&(o+=1);var a=Math.sqrt(o*o+r*r);if(0!==a){o=o/a*i*.024,r=r/a*i*.024;var s=Math.atan2(r,o)*(180/Math.PI),h=i/16,l=Gt(s-Zt(ee,this).rotate);l>180?l-=360:l<-180&&(l+=360),Math.abs(l)<h?Zt(ee,this).rotate=s:Zt(ee,this).rotate+=h*Math.sign(l),Zt(ee,this).rotate=Gt(Zt(ee,this).rotate)}this.x+=o,this.y+=r,t.update(this.x,this.y)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Zt(te,this),n=i.x,o=i.y,r=Zt(ee,this),a=r.radius,s=r.width,h=r.height,l=r.rotate,u=r.headRotate,c=Zt(ie,this),f=c.headImage,y=c.bodyImage;t.save(),t.translate(n,o),t.rotate(l*Math.PI/180),t.shadowOffsetX=0,90===Gt(l)?t.shadowOffsetY=-12:t.shadowOffsetY=10,t.shadowBlur=10,t.shadowColor="rgba(0, 0, 0, 0.4)",t.drawImage(y,-s/2,-h/2,s,h),t.restore(),t.save(),t.translate(n,o),t.rotate(u),t.drawImage(f,-s/2,-h/2,s,h),t.restore(),e&&(t.save(),t.translate(n,o),t.strokeStyle="white",t.beginPath(),t.arc(0,0,a,0,2*Math.PI),t.stroke(),t.restore())}},{key:"drawHPBar",value:function(t,e,i,n,o){var r=this.currentHP/this.maxHP,a=Math.ceil(this.maxHP/500),s=2*n/a;t.save(),t.translate(e-n,i+n+10);for(var h=0;h<a;h++)t.fillStyle=h/a<r?o:"rgba(0, 0, 0, 0)",t.fillRect(h*s,0,s-2,20);t.restore()}}],e&&Jt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function se(t){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(t)}function he(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,le(n.key),n)}}function le(t){var e=function(t){if("object"!=se(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=se(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==se(e)?e:e+""}function ue(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function ce(t,e){return t.get(ye(t,e))}function fe(t,e,i){return t.set(ye(t,e),i),i}function ye(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var me=new WeakMap,pe=new WeakMap,de=new WeakMap,ve=new WeakMap,we=new WeakMap,ge=new WeakMap,be=new WeakMap,ke=new WeakMap,xe=new WeakMap,Se=new WeakMap,Me=function(){return t=function t(){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),ue(this,me,void 0),ue(this,pe,void 0),ue(this,de,void 0),ue(this,ve,void 0),ue(this,we,void 0),ue(this,ge,void 0),ue(this,be,{tanks:{allies:[],enemies:[],player:void 0},bullets:[],collisionEffects:[],map:void 0}),ue(this,ke,{drawBorder:!1,log:!0,gameContainerSize:{widthRatio:1,heightRatio:1}}),ue(this,xe,{drawMap:function(){},drawTanks:function(){var t=ce(be,e).tanks;t.allies.forEach((function(t){t.dead||(t.drawHPBar(ce(pe,e),t.x,t.y,t.radius,"deepskyblue"),t.draw(ce(pe,e),ce(ke,e).drawBorder))})),t.enemies.forEach((function(t){t.dead||(t.drawHPBar(ce(pe,e),t.x,t.y,t.radius,"red"),t.draw(ce(pe,e),ce(ke,e).drawBorder))})),t.player.dead||(t.player.drawHPBar(ce(pe,e),t.player.x,t.player.y,t.player.radius,"green"),t.player.draw(ce(pe,e),ce(ke,e).drawBorder))},drawBullet:function(){var t=ce(be,e),i=t.bullets,n=t.tanks,o=t.collisionEffects,r=t.map.walls,a=t.map;i.forEach((function(t,s){t.draw(ce(pe,e),ce(ke,e).drawBorder),n.enemies.forEach((function(r){!r.dead&&ce(Se,e).isBulletAndTankCollision(r,t)&&(ce(ke,e).log&&console.log("Hit tank detected!"),o.push(new Z(t,200,t.collisionImage)),i.splice(s,1),r.currentHP-=n.player.atk,r.currentHP<=0&&(r.dead=!0,setTimeout((function(){r.dead=!1}),3e3)))})),r.some((function(i){return ce(Se,e).isBulletAndWallCollision(t,i)}))?(ce(ke,e).log&&console.log("Hit wall detected!"),o.push(new Z(t,200,t.collisionImage)),i.splice(s,1)):(t.x<0||t.x>a.size.width||t.y<0||t.y>a.size.height)&&(ce(ke,e).log&&console.log("Bullet out of map, remove"),i.splice(s,1))}))},drawCollisionEffect:function(){var t=ce(be,e).collisionEffects;t.forEach((function(t){return t.draw(ce(pe,e))})),t=t.filter((function(t){return!t.isExpired()}))}}),ue(this,Se,{isBulletAndTankCollision:function(t,e){return function(t,e){for(var i=Math.cos(e.angle),n=Math.sin(e.angle),o=e.width/2,r=e.height/2,a=0,s=[{x:e.x+o*i-r*n,y:e.y+o*n+r*i},{x:e.x-o*i-r*n,y:e.y-o*n+r*i},{x:e.x-o*i+r*n,y:e.y-o*n-r*i},{x:e.x+o*i+r*n,y:e.y+o*n-r*i}];a<s.length;a++){var h=s[a],l=h.x-t.x,u=h.y-t.y;if(l*l+u*u<=t.radius*t.radius)return!0}var c=i*(t.x-e.x)+n*(t.y-e.y)+e.x,f=i*(t.y-e.y)-n*(t.x-e.x)+e.y,y=c-Math.max(e.x-o,Math.min(c,e.x+o)),m=f-Math.max(e.y-r,Math.min(f,e.y+r));return y*y+m*m<=t.radius*t.radius}(t,e)},isBulletAndWallCollision:function(t,e){return function(t,e){for(var i=Math.cos(t.angle),n=Math.sin(t.angle),o=t.width/2,r=t.height/2,a=0,s=[{x:t.x+o*i-r*n,y:t.y+o*n+r*i},{x:t.x-o*i-r*n,y:t.y-o*n+r*i},{x:t.x-o*i+r*n,y:t.y-o*n-r*i},{x:t.x+o*i+r*n,y:t.y+o*n-r*i}];a<s.length;a++){var h=s[a];if(h.x>=e.x&&h.x<=e.x+e.width&&h.y>=e.y&&h.y<=e.y+e.height)return!0}for(var l=0,u=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];l<u.length;l++){var c=u[l],f=i*(c.x-t.x)+n*(c.y-t.y)+t.x,y=-n*(c.x-t.x)+i*(c.y-t.y)+t.y;if(f>=t.x-o&&f<=t.x+o&&y>=t.y-r&&y<=t.y+r)return!0}return!1}(t,e)}}),fe(me,this,document.createElement("canvas")),fe(pe,this,ce(me,this).getContext("2d")),document.body.appendChild(ce(me,this)),fe(ge,this,new Xt),fe(we,this,new ct({x:0,y:0,width:ce(me,this).width,height:ce(me,this).height})),fe(ve,this,new d(ce(me,this),ce(pe,this))),fe(de,this,new T(ce(ve,this))),ce(ve,this).start(),this.resize(),window.addEventListener("resize",(function(){return e.resize()})),window.addEventListener("scroll",(function(t){return t.preventDefault()})),this.loadAssets()},(e=[{key:"resize",value:function(){var t=ce(me,this).parentElement,e=ce(ke,this).gameContainerSize,i=e.widthRatio,n=e.heightRatio;ce(me,this).width=t.clientWidth*i,ce(me,this).height=t.clientHeight*n,ce(we,this).setSize(ce(me,this));var o=ce(be,this).tanks;o.player&&ce(we,this).update(o.player.x,o.player.y)}},{key:"loadAssets",value:function(){var t=this;ce(de,this).onAllAssetsLoaded((function(){return t.onAllAssetsLoaded()})),ce(de,this).loadImage("tank.demo.head","../../assets/tanks/demo/head.png"),ce(de,this).loadImage("tank.demo.body","../../assets/tanks/demo/body.png"),ce(de,this).loadImage("tank.demo.bullet","../../assets/tanks/demo/bullet.png"),ce(de,this).loadImage("tank.demo.collision","../../assets/tanks/demo/collision.png"),ce(de,this).loadImage("map.01","../../assets/maps/map-01/1x4R.jpeg")}},{key:"onAllAssetsLoaded",value:function(){var t=this;this.buildGameEnv();var e=ce(be,this).tanks.player;document.addEventListener("keydown",(function(t){e.setKeyPressedState(t.key,!0)})),document.addEventListener("keyup",(function(t){e.setKeyPressedState(t.key,!1)})),ce(me,this).addEventListener("contextmenu",(function(t){return t.preventDefault()})),ce(me,this).addEventListener("mousemove",(function(e){return t.handleMouseMove(e)})),ce(me,this).addEventListener("click",(function(e){return t.handleClick(e)})),ce(ve,this).complete(),this.resize(),this.draw()}},{key:"buildGameEnv",value:function(){var t=ce(be,this),e=ce(de,this),i=(new ae).withLocation(200,1e3).withDisplay(80,0,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:226,pen:10,armor:40,speed:170}),n=(new ae).withLocation(1e3,700).withDisplay(80,90,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15}),o=(new ae).withLocation(990,900).withDisplay(80,40,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15}),r=(new ae).withLocation(300,300).withDisplay(80,180).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15});t.map=ce(ge,this).getMap("01"),ce(we,this).setMapSize(t.map.size),t.tanks.player=i,t.tanks.enemies.push(n,o),t.tanks.allies.push(r),ce(we,this).apply(ce(pe,this)),ce(we,this).update(i.x,i.y)}},{key:"handleClick",value:function(t){var e=ce(be,this).tanks,i=ce(me,this).getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top,r=n+ce(we,this).x,a=o+ce(we,this).y,s=r-e.player.x,h=a-e.player.y,l=Math.atan2(h,s);ce(be,this).bullets.push((new J).withLocation(e.player.x,e.player.y).withAngle(l).withSpeed(10).withSize(90,30).withImage(e.player.bulletImage).withCollisionImage(e.player.collisionImage)),ce(we,this).update(e.player.x,e.player.y)}},{key:"handleMouseMove",value:function(t){var e=ce(be,this).tanks,i=ce(me,this).getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top,r=n+ce(we,this).x,a=o+ce(we,this).y,s=r-e.player.x,h=a-e.player.y;e.player.headRotate=Math.atan2(h,s)}},{key:"draw",value:function(){var t=this,e=ce(be,this).map.size,i=e.width,n=e.height,o=ce(me,this),r=o.width,a=o.height;ce(pe,this).clearRect(0,0,r,a),ce(pe,this).save(),ce(we,this).apply(ce(pe,this)),ce(pe,this).drawImage(ce(de,this).getImage("map.01"),0,0,i,n),ce(xe,this).drawTanks(),ce(xe,this).drawMap(),ce(xe,this).drawBullet(),ce(xe,this).drawCollisionEffect(),ce(be,this).tanks.player.move(ce(we,this)),ce(pe,this).restore(),requestAnimationFrame((function(){return t.draw()}))}}])&&he(t.prototype,e),i&&he(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ie(){document.getElementById("start").addEventListener("click",(function(t){var e,i;t.target.style.display="none",/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&((i=document.querySelector("meta[name=viewport]"))||((i=document.createElement("meta")).name="viewport",document.head.appendChild(i)),i.content="width=device-width, initial-scale=".concat(.4,", maximum-scale=").concat(.4,", user-scalable=no")),(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation&&screen.orientation.lock?screen.orientation.lock("landscape").catch((function(t){console.error("Khóa màn hình ngang thất bại:",t)})):alert("Thiết bị của bạn không hỗ trợ khóa màn hình."),new Me}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ie):Ie()})();