(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function i(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function o(t,e){return t.get(a(t,e))}function r(t,e,n){return t.set(a(t,e),n),n}function a(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var s=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,y=new WeakMap,d=new WeakMap,m=new WeakMap,p=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,s,void 0),i(this,h,void 0),i(this,l,void 0),i(this,u,void 0),i(this,c,void 0),i(this,f,void 0),i(this,y,void 0),i(this,d,void 0),i(this,m,void 0),r(s,this,e),r(h,this,n),r(l,this,void 0),r(u,this,0),r(c,this,0),r(f,this,!1),r(y,this,0),r(d,this,0),r(m,this,"...")},(n=[{key:"setAssetsLoadedCount",value:function(t){r(d,this,t)}},{key:"setAssetsLimitCount",value:function(t){r(y,this,t)}},{key:"setLoadedAssetsText",value:function(t){r(m,this,t)}},{key:"complete",value:function(){var t=this;r(f,this,!0),setTimeout((function(){return t.stop()}),500)}},{key:"start",value:function(){var t=this,e=Array(parseInt(o(c,this))).fill(".").join(""),n="Đang tải".concat(e),i=o(s,this),a=i.width,p=i.height;o(c,this)>4&&r(c,this,0),r(c,this,o(c,this)+.1),o(h,this).fillStyle="rgb(0, 0, 0)",o(h,this).fillRect(0,0,a,p),o(h,this).save(),o(h,this).translate(a/2,p/2+70),o(h,this).rotate(o(u,this));for(var g=0;g<16;g++)o(h,this).beginPath(),o(h,this).rotate(2*Math.PI/16),o(h,this).moveTo(12,0),o(h,this).lineTo(30,0),o(h,this).lineWidth=2,o(h,this).strokeStyle="rgba(255, 255, 255, ".concat(g/16,")"),o(h,this).stroke();o(h,this).restore(),o(h,this).font="35px Arial",o(h,this).textAlign="center",o(h,this).textBaseline="middle",o(h,this).fillStyle="white",o(h,this).fillText(n,a/2,p/2),o(h,this).font="20px Arial",o(h,this).textAlign="right",o(h,this).textBaseline="bottom",o(h,this).fillStyle="white",o(h,this).fillText(o(f,this)?"Tải hoàn tất":"Đã tải: ".concat(o(m,this)," (").concat(o(d,this),"/").concat(o(y,this),")"),.97*a,.97*p),r(u,this,o(u,this)+.04),r(l,this,requestAnimationFrame((function(){return t.start()})))}},{key:"stop",value:function(){var t=o(s,this),e=t.width,n=t.height;cancelAnimationFrame(o(l,this)),o(h,this).clearRect(0,0,e,n)}}])&&e(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,w(i.key),i)}}function w(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function b(t,e,n){k(t,e),e.set(t,n)}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(t,e,n){return t.set(I(t,e),n),n}function x(t,e){return t.get(I(t,e))}function I(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var M=new WeakMap,P=new WeakMap,E=new WeakMap,j=new WeakMap,T=new WeakSet,W=function(){return t=function t(e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,n=T),n.add(this),b(this,M,{images:{},json:{}}),b(this,P,0),b(this,E,0),b(this,j,void 0),this.assetLoadingInterface=e},(e=[{key:"loadImage",value:function(t,e){var n,i=this;S(P,this,(n=x(P,this),++n)),this.assetLoadingInterface.setAssetsLimitCount(x(P,this));var o=new Image;o.src=e,o.onload=function(){return I(T,i,C).call(i,t,o)}}},{key:"loadJson",value:function(t,e){var n,i=this;S(P,this,(n=x(P,this),++n)),this.assetLoadingInterface.setAssetsLimitCount(x(P,this)),fetch(e).then((function(t){return t.json()})).then((function(e){return I(T,i,A).call(i,t,e)})).catch((function(t){return console.error("Lỗi tải JSON từ ".concat(e,":"),t)}))}},{key:"getImage",value:function(t){var e=x(M,this).images[t];return e||console.warn('Hình ảnh với tên "'.concat(t,'" không tồn tại')),e}},{key:"getJson",value:function(t){var e=x(M,this).json[t];return e||console.warn('JSON với tên "'.concat(t,'" không tồn tại')),e}},{key:"onAllAssetsLoaded",value:function(t){S(j,this,t)}}])&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t,e){x(M,this).images[t]&&console.warn('Hình ảnh với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),x(M,this).images[t]=e,I(T,this,L).call(this,t)}function A(t,e){x(M,this).json[t]&&console.warn('JSON với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),x(M,this).json[t]=e,I(T,this,L).call(this,t)}function L(t){var e;S(E,this,(e=x(E,this),++e)),this.assetLoadingInterface.setLoadedAssetsText(t),this.assetLoadingInterface.setAssetsLoadedCount(x(E,this)),x(E,this)===x(P,this)&&x(j,this)&&x(j,this).call(this)}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,R(i.key),i)}}function R(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}function B(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function H(t,e){return t.get(q(t,e))}function D(t,e,n){return t.set(q(t,e),n),n}function q(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var F=new WeakMap,Y=new WeakMap,X=new WeakMap,J=new WeakMap,G=new WeakMap,K=new WeakMap,N=new WeakMap,U=new WeakMap,$=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),B(this,F,0),B(this,Y,0),B(this,X,0),B(this,J,165),B(this,G,90),B(this,K,30),B(this,N,null),B(this,U,null)},e=[{key:"withLocation",value:function(t,e){return D(F,this,t),D(Y,this,e),this}},{key:"withAngle",value:function(t){return D(X,this,t),this}},{key:"withSpeed",value:function(t){return D(J,this,t),this}},{key:"withSize",value:function(t,e){return D(G,this,t),D(K,this,e),this}},{key:"withImage",value:function(t){return D(N,this,t),this}},{key:"withCollisionImage",value:function(t){return D(U,this,t),this}},{key:"x",get:function(){return H(F,this)}},{key:"y",get:function(){return H(Y,this)}},{key:"angle",get:function(){return H(X,this)}},{key:"speed",get:function(){return H(J,this)}},{key:"width",get:function(){return H(G,this)}},{key:"height",get:function(){return H(K,this)}},{key:"image",get:function(){return H(N,this)}},{key:"collisionImage",get:function(){return H(U,this)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];D(F,this,H(F,this)+Math.cos(H(X,this))*H(J,this)),D(Y,this,H(Y,this)+Math.sin(H(X,this))*H(J,this)),t.save(),t.translate(H(F,this),H(Y,this)),t.rotate(H(X,this)),t.drawImage(H(N,this),-H(G,this)/2,-H(K,this)/2,H(G,this),H(K,this)),t.restore(),e&&(t.save(),t.translate(H(F,this),H(Y,this)),t.rotate(H(X,this)),t.strokeStyle="blue",t.strokeRect(-H(G,this)/2,-H(K,this)/2,H(G,this),H(K,this)),t.restore())}}],e&&z(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Z(i.key),i)}}function Z(t){var e=function(t){if("object"!=Q(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Q(e)?e:e+""}var _=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.duration=n,this.startTime=Date.now(),this.image=i,this.maxWidth=o,this.maxHeight=r,this.radius=10,this.calculateCollisionPoint(e)},(e=[{key:"calculateCollisionPoint",value:function(t){var e=t.angle,n=t.width/2,i=t.height/2,o=Math.cos(e)*n,r=Math.sin(e)*i;this.collisionX=t.x+o,this.collisionY=t.y+r}},{key:"isExpired",value:function(){return Date.now()-this.startTime>this.duration}},{key:"draw",value:function(t){if(!this.isExpired()){var e,n=(Date.now()-this.startTime)/this.duration,i=1+.5*n;if(e=n<=.45?1:1-(n-.45)/.55,t.save(),t.globalAlpha=e,t.translate(this.collisionX,this.collisionY),t.scale(i,i),t.translate(-this.collisionX,-this.collisionY),this.image){var o=this.image.width/this.image.height,r=this.image.width,a=this.image.height;r>this.maxWidth&&(a=(r=this.maxWidth)/o),a>this.maxHeight&&(r=(a=this.maxHeight)*o),t.drawImage(this.image,this.collisionX-r/2,this.collisionY-a/2,r,a)}else t.fillStyle="red",t.beginPath(),t.arc(this.collisionX,this.collisionY,this.radius,0,2*Math.PI),t.fill();t.restore()}}}])&&V(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,nt(i.key),i)}}function nt(t){var e=function(t){if("object"!=tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tt(e)?e:e+""}function it(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function ot(t,e){return t.get(at(t,e))}function rt(t,e,n){return t.set(at(t,e),n),n}function at(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var st=new WeakMap,ht=new WeakMap,lt=new WeakMap,ut=new WeakMap,ct=new WeakMap,ft=new WeakMap,yt=function(){return t=function t(e){var n=e.x,i=e.y,o=e.width,r=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),it(this,st,void 0),it(this,ht,void 0),it(this,lt,void 0),it(this,ut,void 0),it(this,ct,void 0),it(this,ft,void 0),rt(st,this,n),rt(ht,this,i),rt(lt,this,o),rt(ut,this,r)},(e=[{key:"x",get:function(){return ot(st,this)}},{key:"y",get:function(){return ot(ht,this)}},{key:"width",get:function(){return ot(lt,this)}},{key:"height",get:function(){return ot(ut,this)}},{key:"mapWidth",get:function(){return ot(ct,this)}},{key:"mapHeight",get:function(){return ot(ft,this)}},{key:"setSize",value:function(t){var e=t.width,n=t.height;rt(lt,this,e),rt(ut,this,n)}},{key:"setMapSize",value:function(t){var e=t.width,n=t.height;rt(ct,this,e),rt(ft,this,n)}},{key:"update",value:function(t,e){rt(st,this,t-ot(lt,this)/2),rt(ht,this,e-ot(ut,this)/2),this.clamp()}},{key:"apply",value:function(t){t.translate(-ot(st,this),-ot(ht,this))}},{key:"clamp",value:function(){rt(st,this,Math.max(0,Math.min(ot(st,this),ot(ct,this)-ot(lt,this)))),rt(ht,this,Math.max(0,Math.min(ot(ht,this),ot(ft,this)-ot(ut,this))))}}])&&et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dt(t){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(t)}function mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,pt(i.key),i)}}function pt(t){var e=function(t){if("object"!=dt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dt(e)?e:e+""}function gt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function vt(t,e){return t.get(bt(t,e))}function wt(t,e,n){return t.set(bt(t,e),n),n}function bt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var kt=new WeakMap,St=new WeakMap,xt=function(){return t=function t(e){var n=e.location,i=n.x,o=n.y,r=e.display,a=r.width,s=r.height,h=r.color;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gt(this,kt,void 0),gt(this,St,void 0),wt(kt,this,{x:i,y:o}),wt(St,this,{width:a,height:s,color:null!=h?h:"black"})},(e=[{key:"x",get:function(){return vt(kt,this).x}},{key:"y",get:function(){return vt(kt,this).y}},{key:"width",get:function(){return vt(St,this).width}},{key:"height",get:function(){return vt(St,this).height}},{key:"draw",value:function(t){var e=vt(kt,this),n=e.x,i=e.y,o=vt(St,this),r=o.width,a=o.height,s=o.color;t.save(),t.fillStyle=s,t.fillRect(n,i,r,a),t.restore()}}])&&mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Pt(i.key),i)}}function Pt(t){var e=function(t){if("object"!=It(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=It(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==It(e)?e:e+""}function Et(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function jt(t,e,n){return t.set(Wt(t,e),n),n}function Tt(t,e){return t.get(Wt(t,e))}function Wt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Ct=new WeakMap,At=new WeakMap,Lt=new WeakMap,Ot=function(){return t=function t(e,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Et(this,Ct,{width:0,height:0}),Et(this,At,void 0),Et(this,Lt,[]),Object.assign(Tt(Ct,this),{width:e,height:n}),jt(Lt,this,i),jt(At,this,o)},(e=[{key:"walls",get:function(){return Tt(Lt,this)}},{key:"size",get:function(){return Tt(Ct,this)}},{key:"backgroundImage",get:function(){return Tt(At,this)}},{key:"draw",value:function(t){Tt(Lt,this).forEach((function(e){return e.draw(t)}))}}])&&Mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Bt(i.key),i)}}function Bt(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}function Ht(t,e,n){Dt(t,e),e.set(t,n)}function Dt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qt(t,e){return t.get(Ft(t,e))}function Ft(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Yt=new WeakMap,Xt=new WeakMap,Jt=new WeakSet,Gt=function(){return t=function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Dt(this,e=Jt),e.add(this),Ht(this,Yt,{"Demo map":{size:{width:2e3,height:2e3},walls:[{x:500,y:500,width:100,height:300},{x:800,y:200,width:200,height:100},{x:1e3,y:700,width:300,height:100},{x:200,y:800,width:100,height:400}]},"01":{originalSize:{width:2560,height:1940},size:{width:2560/1.2,height:1940/1.2},walls:[],obstacles:[]}}),Ht(this,Xt,{}),Ft(Jt,this,Kt).call(this)},(e=[{key:"getMap",value:function(t){return qt(Xt,this)[t]}}])&&Rt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Kt(){var t=qt(Yt,this);for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e],i=n.size,o=i.width,r=i.height,a=n.walls;qt(Xt,this)[e]=new Ot(o,r,a.map((function(t){var e=t.x,n=t.y,i=t.width,o=t.height,r=t.color;return new xt({location:{x:e,y:n},display:{width:i,height:o,color:r}})})))}}const Nt=function(t){return(t%360+360)%360};function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function $t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Qt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Vt(i.key),i)}}function Vt(t){var e=function(t){if("object"!=Ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}function Zt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function _t(t,e,n){return t.set(ee(t,e),n),n}function te(t,e){return t.get(ee(t,e))}function ee(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var ne=new WeakMap,ie=new WeakMap,oe=new WeakMap,re=new WeakMap,ae=new WeakMap,se=new WeakMap,he=new WeakMap,le=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Zt(this,ne,!1),Zt(this,ie,{x:0,y:0}),Zt(this,oe,{radius:75,rotate:0,headRotate:0,width:150,height:150}),Zt(this,re,{headImage:void 0,bodyImage:void 0,bulletImage:void 0,collisionImage:null}),Zt(this,ae,{hp:0,maxHp:0,atk:0,pen:0,armor:0,speed:0,bulletRange:0,bulletSpeed:0}),Zt(this,se,{}),Zt(this,he,Date.now())},e=[{key:"dead",get:function(){return te(ne,this)},set:function(t){_t(ne,this,t),te(ne,this)||(this.currentHP=te(ae,this).maxHp)}},{key:"currentHP",get:function(){return te(ae,this).hp},set:function(t){te(ae,this).hp=t}},{key:"maxHp",get:function(){return te(ae,this).maxHp},set:function(t){te(ae,this).maxHp=t}},{key:"x",get:function(){return te(ie,this).x},set:function(t){te(ie,this).x=t}},{key:"y",get:function(){return te(ie,this).y},set:function(t){te(ie,this).y=t}},{key:"radius",get:function(){return te(oe,this).radius}},{key:"speed",get:function(){return te(ae,this).speed}},{key:"bulletImage",get:function(){return te(re,this).bulletImage}},{key:"collisionImage",get:function(){return te(re,this).collisionImage}},{key:"rotate",get:function(){return te(oe,this).rotate},set:function(t){te(oe,this).rotate=t}},{key:"headRotate",get:function(){return te(oe,this).headRotate},set:function(t){te(oe,this).headRotate=t}},{key:"atk",get:function(){return te(ae,this).atk}},{key:"setKeyPressedState",value:function(t,e){te(se,this)[t]=e}},{key:"withLocation",value:function(t,e){return _t(ie,this,{x:t,y:e}),this}},{key:"withDisplay",value:function(t,e,n){return _t(oe,this,{radius:t,rotate:e,headRotate:n}),te(oe,this).width=2*t,te(oe,this).height=2*t,this}},{key:"withTankImage",value:function(t){var e=t.headImage,n=t.bodyImage,i=t.bulletImage,o=t.collisionImage;return _t(re,this,{headImage:e,bodyImage:n,bulletImage:i,collisionImage:o}),this}},{key:"withStats",value:function(t){var e=t.hp,n=t.atk,i=t.pen,o=t.armor,r=t.speed,a=t.bulletRange,s=t.bulletSpeed;return _t(ae,this,{hp:e,maxHp:e,atk:n,pen:i,armor:o,speed:r,bulletRange:a,bulletSpeed:s}),this}},{key:"move",value:function(t){var e=Date.now(),n=te(ae,this).speed,i=te(se,this);_t(he,this,e);var o=0,r=0;(i.w||i.ArrowUp)&&(r-=1),(i.a||i.ArrowLeft)&&(o-=1),(i.s||i.ArrowDown)&&(r+=1),(i.d||i.ArrowRight)&&(o+=1);var a=Math.sqrt(o*o+r*r);if(0!==a){o=o/a*n*.024,r=r/a*n*.024;var s=Math.atan2(r,o)*(180/Math.PI),h=n/16,l=Nt(s-te(oe,this).rotate);l>180?l-=360:l<-180&&(l+=360),Math.abs(l)<h?te(oe,this).rotate=s:te(oe,this).rotate+=h*Math.sign(l),te(oe,this).rotate=Nt(te(oe,this).rotate)}this.x+=o,this.y+=r,t.update(this.x,this.y)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=te(ie,this),i=n.x,o=n.y,r=te(oe,this),a=r.radius,s=r.width,h=r.height,l=r.rotate,u=r.headRotate,c=te(re,this),f=c.headImage,y=c.bodyImage;t.save(),t.translate(i,o),t.rotate(l*Math.PI/180),t.shadowOffsetX=0,90===Nt(l)?t.shadowOffsetY=-12:t.shadowOffsetY=10,t.shadowBlur=14,t.shadowColor="rgba(0, 0, 0, 0.6)",t.drawImage(y,-s/2,-h/2,s,h),t.restore(),t.save(),t.translate(i,o),t.rotate(u),t.drawImage(f,-s/2,-h/2,s,h),t.restore(),e&&(t.save(),t.translate(i,o),t.strokeStyle="white",t.beginPath(),t.arc(0,0,a,0,2*Math.PI),t.stroke(),t.restore())}},{key:"drawHPBar",value:function(t,e,n){var i=te(ie,this),o=i.x,r=i.y,a=te(oe,this),s=a.width,h=a.height,l=te(ae,this),u=l.hp,c=l.maxHp,f=.75*s,y=.105*h,d=o-f/2,m=r+this.radius+10,p=u/c*f;t.save(),t.beginPath(),t.strokeStyle="rgba(0, 0, 0, .2)",t.lineWidth=1.5,t.roundRect(d-1,m-1,f+2,y+2,4),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(0, 0, 0, .7)",t.lineWidth=1,t.roundRect(d-2,m-2,f+4,y+4,4),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(0, 0, 0, .7)",t.lineWidth=1,t.roundRect(d,m,f,y,4),t.stroke(),t.closePath();var g=t.createLinearGradient(d,m,d,m+y);g.addColorStop(0,"rgba(0, 0, 0, .55)"),g.addColorStop(.6,"rgba(0, 0, 0, .55)"),g.addColorStop(1,this.darkenColor("rgba(0, 0, 0, .55)",.2)),t.fillStyle=g,t.beginPath(),t.roundRect(d+.5,m+.5,f-1,y-1,0),t.fill(),t.closePath();var v=t.createLinearGradient(d,m,d,m+y);if(v.addColorStop(0,e),v.addColorStop(.5,e),v.addColorStop(1,this.darkenColor(e,.5)),t.fillStyle=v,t.beginPath(),t.roundRect(d+.5,m+.5,p-1,y-1,0),t.fill(),t.closePath(),c<7501){t.strokeStyle="black";for(var w=f/(c/500),b=1;b<c/500;b++){var k=d+b*w;t.beginPath(),t.moveTo(k,m+1-1),t.lineTo(k,m+y-.3*y),t.stroke()}}t.fillStyle=e,t.font="bold ".concat(.15*h,"px Arial"),t.textAlign="center",t.textBaseline="top",t.shadowColor="rgba(0, 0, 0, .75)",t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=0;var S=m+y+10;t.fillText(n,o,S),t.fillStyle=e,t.font="bold ".concat(.15*h,"px Arial"),t.textAlign="center",t.textBaseline="top",t.fillText(n,o,S),t.restore()}},{key:"darkenColor",value:function(t,e){var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,a,s=[],h=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;h=!1}else for(;!(h=(i=r.call(n)).done)&&(s.push(i.value),s.length!==e);h=!0);}catch(t){l=!0,o=t}finally{try{if(!h&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return $t(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.match(/\d+/g).map(Number),3),i=n[0],o=n[1],r=n[2];return"rgb(".concat(Math.max(i-255*e,0),", ").concat(Math.max(o-255*e,0),", ").concat(Math.max(r-255*e,0),")")}}],e&&Qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ue(t){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(t)}function ce(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,fe(i.key),i)}}function fe(t){var e=function(t){if("object"!=ue(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ue(e)?e:e+""}function ye(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function de(t,e){return t.get(pe(t,e))}function me(t,e,n){return t.set(pe(t,e),n),n}function pe(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var ge=new WeakMap,ve=new WeakMap,we=new WeakMap,be=new WeakMap,ke=new WeakMap,Se=new WeakMap,xe=new WeakMap,Ie=new WeakMap,Me=new WeakMap,Pe=new WeakMap,Ee=function(){return t=function t(){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),ye(this,ge,void 0),ye(this,ve,void 0),ye(this,we,void 0),ye(this,be,void 0),ye(this,ke,void 0),ye(this,Se,void 0),ye(this,xe,{tanks:{allies:[],enemies:[],player:void 0},bullets:[],collisionEffects:[],map:void 0}),ye(this,Ie,{drawBorder:!1,log:!0,gameContainerSize:{widthRatio:1,heightRatio:1}}),ye(this,Me,{drawMap:function(){},drawTanks:function(){var t=de(xe,e).tanks;t.allies.forEach((function(t,n){t.dead||(t.drawHPBar(de(ve,e),"rgb(0, 191, 255)","Ally ".concat(n+1)),t.draw(de(ve,e),de(Ie,e).drawBorder))})),t.enemies.forEach((function(t,n){t.dead||(t.drawHPBar(de(ve,e),"rgb(255, 0, 0)","Enemy ".concat(n+1)),t.draw(de(ve,e),de(Ie,e).drawBorder))})),t.player.dead||(t.player.drawHPBar(de(ve,e),"rgb(0, 180, 0)","Player"),t.player.draw(de(ve,e),de(Ie,e).drawBorder))},drawBullet:function(){var t=de(xe,e),n=t.bullets,i=t.tanks,o=t.collisionEffects,r=t.map.walls,a=t.map;n.forEach((function(t,s){t.draw(de(ve,e),de(Ie,e).drawBorder),i.enemies.forEach((function(r){!r.dead&&de(Pe,e).isBulletAndTankCollision(r,t)&&(de(Ie,e).log&&console.log("Hit tank detected!"),o.push(new _(t,200,t.collisionImage)),n.splice(s,1),r.currentHP-=i.player.atk,r.currentHP<=0&&(r.dead=!0,setTimeout((function(){r.dead=!1}),3e3)))})),r.some((function(n){return de(Pe,e).isBulletAndWallCollision(t,n)}))?(de(Ie,e).log&&console.log("Hit wall detected!"),o.push(new _(t,200,t.collisionImage)),n.splice(s,1)):(t.x<0||t.x>a.size.width||t.y<0||t.y>a.size.height)&&(de(Ie,e).log&&console.log("Bullet out of map, remove"),n.splice(s,1))}))},drawCollisionEffect:function(){var t=de(xe,e).collisionEffects;t.forEach((function(t){return t.draw(de(ve,e))})),t=t.filter((function(t){return!t.isExpired()}))}}),ye(this,Pe,{isBulletAndTankCollision:function(t,e){return function(t,e){for(var n=Math.cos(e.angle),i=Math.sin(e.angle),o=e.width/2,r=e.height/2,a=0,s=[{x:e.x+o*n-r*i,y:e.y+o*i+r*n},{x:e.x-o*n-r*i,y:e.y-o*i+r*n},{x:e.x-o*n+r*i,y:e.y-o*i-r*n},{x:e.x+o*n+r*i,y:e.y+o*i-r*n}];a<s.length;a++){var h=s[a],l=h.x-t.x,u=h.y-t.y;if(l*l+u*u<=t.radius*t.radius)return!0}var c=n*(t.x-e.x)+i*(t.y-e.y)+e.x,f=n*(t.y-e.y)-i*(t.x-e.x)+e.y,y=c-Math.max(e.x-o,Math.min(c,e.x+o)),d=f-Math.max(e.y-r,Math.min(f,e.y+r));return y*y+d*d<=t.radius*t.radius}(t,e)},isBulletAndWallCollision:function(t,e){return function(t,e){for(var n=Math.cos(t.angle),i=Math.sin(t.angle),o=t.width/2,r=t.height/2,a=0,s=[{x:t.x+o*n-r*i,y:t.y+o*i+r*n},{x:t.x-o*n-r*i,y:t.y-o*i+r*n},{x:t.x-o*n+r*i,y:t.y-o*i-r*n},{x:t.x+o*n+r*i,y:t.y+o*i-r*n}];a<s.length;a++){var h=s[a];if(h.x>=e.x&&h.x<=e.x+e.width&&h.y>=e.y&&h.y<=e.y+e.height)return!0}for(var l=0,u=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];l<u.length;l++){var c=u[l],f=n*(c.x-t.x)+i*(c.y-t.y)+t.x,y=-i*(c.x-t.x)+n*(c.y-t.y)+t.y;if(f>=t.x-o&&f<=t.x+o&&y>=t.y-r&&y<=t.y+r)return!0}return!1}(t,e)}}),me(ge,this,document.createElement("canvas")),me(ve,this,de(ge,this).getContext("2d")),document.body.appendChild(de(ge,this)),me(Se,this,new Gt),me(ke,this,new yt({x:0,y:0,width:de(ge,this).width,height:de(ge,this).height})),me(be,this,new p(de(ge,this),de(ve,this))),me(we,this,new W(de(be,this))),de(be,this).start(),this.resize(),window.addEventListener("resize",(function(){return e.resize()})),window.addEventListener("scroll",(function(t){return t.preventDefault()})),this.loadAssets()},(e=[{key:"resize",value:function(){var t=de(ge,this).parentElement,e=de(Ie,this).gameContainerSize,n=e.widthRatio,i=e.heightRatio;de(ge,this).width=t.clientWidth*n,de(ge,this).height=t.clientHeight*i,de(ke,this).setSize(de(ge,this));var o=de(xe,this).tanks;o.player&&de(ke,this).update(o.player.x,o.player.y)}},{key:"loadAssets",value:function(){var t=this;de(we,this).onAllAssetsLoaded((function(){return t.onAllAssetsLoaded()})),de(we,this).loadImage("tank.demo.head","assets/images/tanks/demo/head.png"),de(we,this).loadImage("tank.demo.body","assets/images/tanks/demo/body.png"),de(we,this).loadImage("tank.demo.bullet","assets/images/tanks/demo/bullet.png"),de(we,this).loadImage("tank.demo.collision","assets/images/tanks/demo/collision.png"),de(we,this).loadImage("map.01","assets/images/maps/map-01/bg.jpeg")}},{key:"onAllAssetsLoaded",value:function(){var t=this;this.buildGameEnv();var e=de(xe,this).tanks.player;document.addEventListener("keydown",(function(t){e.setKeyPressedState(t.key,!0)})),document.addEventListener("keyup",(function(t){e.setKeyPressedState(t.key,!1)})),de(ge,this).addEventListener("contextmenu",(function(t){return t.preventDefault()})),de(ge,this).addEventListener("mousemove",(function(e){return t.handleMouseMove(e)})),de(ge,this).addEventListener("click",(function(e){return t.handleClick(e)})),de(be,this).complete(),this.resize(),this.draw()}},{key:"buildGameEnv",value:function(){var t=de(xe,this),e=de(we,this),n=(new le).withLocation(200,1e3).withDisplay(75,0,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:226,pen:10,armor:40,speed:170}),i=(new le).withLocation(1e3,700).withDisplay(75,90,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:8981,atk:186,pen:10,armor:40,speed:15}),o=(new le).withLocation(990,900).withDisplay(75,40,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:5981,atk:186,pen:10,armor:40,speed:15}),r=(new le).withLocation(300,300).withDisplay(75,180).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15});t.map=de(Se,this).getMap("01"),de(ke,this).setMapSize(t.map.size),t.tanks.player=n,t.tanks.enemies.push(i,o),t.tanks.allies.push(r),de(ke,this).apply(de(ve,this)),de(ke,this).update(n.x,n.y)}},{key:"handleClick",value:function(t){var e=de(xe,this).tanks,n=de(ge,this).getBoundingClientRect(),i=t.clientX-n.left,o=t.clientY-n.top,r=i+de(ke,this).x,a=o+de(ke,this).y,s=r-e.player.x,h=a-e.player.y,l=Math.atan2(h,s);de(xe,this).bullets.push((new $).withLocation(e.player.x,e.player.y).withAngle(l).withSpeed(10).withSize(100,100/3).withImage(e.player.bulletImage).withCollisionImage(e.player.collisionImage)),de(ke,this).update(e.player.x,e.player.y)}},{key:"handleMouseMove",value:function(t){var e=de(xe,this).tanks,n=de(ge,this).getBoundingClientRect(),i=t.clientX-n.left,o=t.clientY-n.top,r=i+de(ke,this).x,a=o+de(ke,this).y,s=r-e.player.x,h=a-e.player.y;e.player.headRotate=Math.atan2(h,s)}},{key:"draw",value:function(){var t=this,e=de(xe,this).map.size,n=e.width,i=e.height,o=de(ge,this),r=o.width,a=o.height;de(ve,this).clearRect(0,0,r,a),de(ve,this).save(),de(ke,this).apply(de(ve,this)),de(ve,this).drawImage(de(we,this).getImage("map.01"),0,0,n,i),de(Me,this).drawTanks(),de(Me,this).drawMap(),de(Me,this).drawBullet(),de(Me,this).drawCollisionEffect(),de(xe,this).tanks.player.move(de(ke,this)),de(ve,this).restore(),requestAnimationFrame((function(){return t.draw()}))}}])&&ce(t.prototype,e),n&&ce(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function je(t){"development"!=t?document.getElementById("start").addEventListener("click",(function(t){var e,n;t.target.style.display="none",/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&((n=document.querySelector("meta[name=viewport]"))||((n=document.createElement("meta")).name="viewport",document.head.appendChild(n)),n.content="width=device-width, initial-scale=".concat(.4,", maximum-scale=").concat(.4,", user-scalable=no")),(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation&&screen.orientation.lock?screen.orientation.lock("landscape").catch((function(t){console.error("Khóa màn hình ngang thất bại:",t)})):alert("Thiết bị của bạn không hỗ trợ khóa màn hình."),new Ee})):(document.getElementById("start").style.display="none",new Ee)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",je):je("development")})();