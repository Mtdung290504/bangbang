(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(e){var i=function(e){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(i)?i:i+""}function n(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function o(t,e){return t.get(a(t,e))}function r(t,e,i){return t.set(a(t,e),i),i}function a(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var s=new WeakMap,h=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,f=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,d=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,s,void 0),n(this,h,void 0),n(this,u,void 0),n(this,l,void 0),n(this,c,void 0),n(this,f,void 0),n(this,y,void 0),n(this,p,void 0),n(this,m,void 0),r(s,this,e),r(h,this,i),r(u,this,void 0),r(l,this,0),r(c,this,0),r(f,this,!1),r(y,this,0),r(p,this,0),r(m,this,"...")},(i=[{key:"setAssetsLoadedCount",value:function(t){r(p,this,t)}},{key:"setAssetsLimitCount",value:function(t){r(y,this,t)}},{key:"setLoadedAssetsText",value:function(t){r(m,this,t)}},{key:"complete",value:function(){var t=this;r(f,this,!0),setTimeout((function(){return t.stop()}),500)}},{key:"start",value:function(){var t=this,e=Array(parseInt(o(c,this))).fill(".").join(""),i="Đang tải".concat(e),n=o(s,this),a=n.width,d=n.height;o(c,this)>4&&r(c,this,0),r(c,this,o(c,this)+.1),o(h,this).fillStyle="rgb(0, 0, 0)",o(h,this).fillRect(0,0,a,d),o(h,this).save(),o(h,this).translate(a/2,d/2+70),o(h,this).rotate(o(l,this));for(var v=0;v<16;v++)o(h,this).beginPath(),o(h,this).rotate(2*Math.PI/16),o(h,this).moveTo(12,0),o(h,this).lineTo(30,0),o(h,this).lineWidth=2,o(h,this).strokeStyle="rgba(255, 255, 255, ".concat(v/16,")"),o(h,this).stroke();o(h,this).restore(),o(h,this).font="35px Arial",o(h,this).textAlign="center",o(h,this).textBaseline="middle",o(h,this).fillStyle="white",o(h,this).fillText(i,a/2,d/2),o(h,this).font="20px Arial",o(h,this).textAlign="right",o(h,this).textBaseline="bottom",o(h,this).fillStyle="white",o(h,this).fillText(o(f,this)?"Tải hoàn tất":"Đã tải: ".concat(o(m,this)," (").concat(o(p,this),"/").concat(o(y,this),")"),.97*a,.97*d),r(l,this,o(l,this)+.04),r(u,this,requestAnimationFrame((function(){return t.start()})))}},{key:"stop",value:function(){var t=o(s,this),e=t.width,i=t.height;cancelAnimationFrame(o(u,this)),o(h,this).clearRect(0,0,e,i)}}])&&e(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function g(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=v(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}function b(t,e,i){k(t,e),e.set(t,i)}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(t,e,i){return t.set(I(t,e),i),i}function x(t,e){return t.get(I(t,e))}function I(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var M=new WeakMap,E=new WeakMap,P=new WeakMap,j=new WeakMap,W=new WeakSet,T=function(){return t=function t(e){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,i=W),i.add(this),b(this,M,{images:{}}),b(this,E,0),b(this,P,0),b(this,j,void 0),this.assetLoadingInterface=e},(e=[{key:"loadImage",value:function(t,e){var i,n=this;S(E,this,(i=x(E,this),++i)),this.assetLoadingInterface.setAssetsLimitCount(x(E,this));var o=new Image;o.src=e,o.onload=function(){return I(W,n,C).call(n,t,o)}}},{key:"getImage",value:function(t){var e=x(M,this).images[t];return e||console.warn('Hình ảnh với tên "'.concat(t,'" không tồn tại')),e}},{key:"onAllAssetsLoaded",value:function(t){S(j,this,t)}}])&&w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t,e){var i;x(M,this).images[t]&&console.warn('Hình ảnh với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),x(M,this).images[t]=e,S(P,this,(i=x(P,this),++i)),this.assetLoadingInterface.setLoadedAssetsText(t),this.assetLoadingInterface.setAssetsLoadedCount(x(P,this)),x(P,this)===x(E,this)&&x(j,this)&&x(j,this).call(this)}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function L(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,z(n.key),n)}}function z(t){var e=function(t){if("object"!=A(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=A(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}function O(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function R(t,e){return t.get(D(t,e))}function B(t,e,i){return t.set(D(t,e),i),i}function D(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var H=new WeakMap,Y=new WeakMap,X=new WeakMap,q=new WeakMap,F=new WeakMap,K=new WeakMap,G=new WeakMap,U=new WeakMap,J=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),O(this,H,void 0),O(this,Y,void 0),O(this,X,void 0),O(this,q,void 0),O(this,F,void 0),O(this,K,void 0),O(this,G,void 0),O(this,U,void 0),B(H,this,0),B(Y,this,0),B(X,this,0),B(q,this,0),B(F,this,0),B(K,this,0),B(G,this,null)},e=[{key:"withLocation",value:function(t,e){return B(H,this,t),B(Y,this,e),this}},{key:"withAngle",value:function(t){return B(X,this,t),this}},{key:"withSpeed",value:function(t){return B(q,this,t),this}},{key:"withSize",value:function(t,e){return B(F,this,t),B(K,this,e),this}},{key:"withImage",value:function(t){return B(G,this,t),this}},{key:"withCollisionImage",value:function(t){return B(U,this,t),this}},{key:"x",get:function(){return R(H,this)}},{key:"y",get:function(){return R(Y,this)}},{key:"angle",get:function(){return R(X,this)}},{key:"speed",get:function(){return R(q,this)}},{key:"width",get:function(){return R(F,this)}},{key:"height",get:function(){return R(K,this)}},{key:"image",get:function(){return R(G,this)}},{key:"collisionImage",get:function(){return R(U,this)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B(H,this,R(H,this)+Math.cos(R(X,this))*R(q,this)),B(Y,this,R(Y,this)+Math.sin(R(X,this))*R(q,this)),t.save(),t.translate(R(H,this),R(Y,this)),t.rotate(R(X,this)),t.drawImage(R(G,this),-R(F,this)/2,-R(K,this)/2,R(F,this),R(K,this)),t.restore(),e&&(t.save(),t.translate(R(H,this),R(Y,this)),t.rotate(R(X,this)),t.strokeStyle="blue",t.strokeRect(-R(F,this)/2,-R(K,this)/2,R(F,this),R(K,this)),t.restore())}}],e&&L(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function Q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,V(n.key),n)}}function V(t){var e=function(t){if("object"!=N(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=N(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==N(e)?e:e+""}var Z=function(){return t=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.duration=i,this.startTime=Date.now(),this.image=n,this.maxWidth=o,this.maxHeight=r,this.radius=10,this.calculateCollisionPoint(e)},(e=[{key:"calculateCollisionPoint",value:function(t){var e=t.angle,i=t.width/2,n=t.height/2,o=Math.cos(e)*i,r=Math.sin(e)*n;this.collisionX=t.x+o,this.collisionY=t.y+r}},{key:"isExpired",value:function(){return Date.now()-this.startTime>this.duration}},{key:"draw",value:function(t){if(!this.isExpired()){var e,i=(Date.now()-this.startTime)/this.duration,n=1+.5*i;if(e=i<=.45?1:1-(i-.45)/.55,t.save(),t.globalAlpha=e,t.translate(this.collisionX,this.collisionY),t.scale(n,n),t.translate(-this.collisionX,-this.collisionY),this.image){var o=this.image.width/this.image.height,r=this.image.width,a=this.image.height;r>this.maxWidth&&(a=(r=this.maxWidth)/o),a>this.maxHeight&&(r=(a=this.maxHeight)*o),t.drawImage(this.image,this.collisionX-r/2,this.collisionY-a/2,r,a)}else t.fillStyle="red",t.beginPath(),t.arc(this.collisionX,this.collisionY,this.radius,0,2*Math.PI),t.fill();t.restore()}}}])&&Q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tt(n.key),n)}}function tt(t){var e=function(t){if("object"!=$(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=$(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$(e)?e:e+""}function et(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function it(t,e){return t.get(ot(t,e))}function nt(t,e,i){return t.set(ot(t,e),i),i}function ot(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var rt=new WeakMap,at=new WeakMap,st=new WeakMap,ht=new WeakMap,ut=new WeakMap,lt=new WeakMap,ct=function(){return t=function t(e){var i=e.x,n=e.y,o=e.width,r=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),et(this,rt,void 0),et(this,at,void 0),et(this,st,void 0),et(this,ht,void 0),et(this,ut,void 0),et(this,lt,void 0),nt(rt,this,i),nt(at,this,n),nt(st,this,o),nt(ht,this,r)},(e=[{key:"x",get:function(){return it(rt,this)}},{key:"y",get:function(){return it(at,this)}},{key:"width",get:function(){return it(st,this)}},{key:"height",get:function(){return it(ht,this)}},{key:"mapWidth",get:function(){return it(ut,this)}},{key:"mapHeight",get:function(){return it(lt,this)}},{key:"setSize",value:function(t){var e=t.width,i=t.height;nt(st,this,e),nt(ht,this,i)}},{key:"setMapSize",value:function(t){var e=t.width,i=t.height;nt(ut,this,e),nt(lt,this,i)}},{key:"update",value:function(t,e){nt(rt,this,t-it(st,this)/2),nt(at,this,e-it(ht,this)/2),this.clamp()}},{key:"apply",value:function(t){t.translate(-it(rt,this),-it(at,this))}},{key:"clamp",value:function(){nt(rt,this,Math.max(0,Math.min(it(rt,this),it(ut,this)-it(st,this)))),nt(at,this,Math.max(0,Math.min(it(at,this),it(lt,this)-it(ht,this))))}}])&&_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function yt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pt(n.key),n)}}function pt(t){var e=function(t){if("object"!=ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ft(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ft(e)?e:e+""}function mt(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function dt(t,e){return t.get(wt(t,e))}function vt(t,e,i){return t.set(wt(t,e),i),i}function wt(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var gt=new WeakMap,bt=new WeakMap,kt=function(){return t=function t(e){var i=e.location,n=i.x,o=i.y,r=e.display,a=r.width,s=r.height,h=r.color;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),mt(this,gt,void 0),mt(this,bt,void 0),vt(gt,this,{x:n,y:o}),vt(bt,this,{width:a,height:s,color:null!=h?h:"black"})},(e=[{key:"x",get:function(){return dt(gt,this).x}},{key:"y",get:function(){return dt(gt,this).y}},{key:"width",get:function(){return dt(bt,this).width}},{key:"height",get:function(){return dt(bt,this).height}},{key:"draw",value:function(t){var e=dt(gt,this),i=e.x,n=e.y,o=dt(bt,this),r=o.width,a=o.height,s=o.color;t.save(),t.fillStyle=s,t.fillRect(i,n,r,a),t.restore()}}])&&yt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function St(t){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(t)}function xt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,It(n.key),n)}}function It(t){var e=function(t){if("object"!=St(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=St(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==St(e)?e:e+""}function Mt(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function Et(t,e,i){return t.set(jt(t,e),i),i}function Pt(t,e){return t.get(jt(t,e))}function jt(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Wt=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,At=function(){return t=function t(e,i,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Mt(this,Wt,{width:0,height:0}),Mt(this,Tt,void 0),Mt(this,Ct,[]),Object.assign(Pt(Wt,this),{width:e,height:i}),Et(Ct,this,n),Et(Tt,this,o)},(e=[{key:"walls",get:function(){return Pt(Ct,this)}},{key:"size",get:function(){return Pt(Wt,this)}},{key:"backgroundImage",get:function(){return Pt(Tt,this)}},{key:"draw",value:function(t){Pt(Ct,this).forEach((function(e){return e.draw(t)}))}}])&&xt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function zt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ot(n.key),n)}}function Ot(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Lt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}function Rt(t,e,i){Bt(t,e),e.set(t,i)}function Bt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Dt(t,e){return t.get(Ht(t,e))}function Ht(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Yt=new WeakMap,Xt=new WeakMap,qt=new WeakSet,Ft=function(){return t=function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Bt(this,e=qt),e.add(this),Rt(this,Yt,{"Demo map":{size:{width:2e3,height:2e3},walls:[{x:500,y:500,width:100,height:300},{x:800,y:200,width:200,height:100},{x:1e3,y:700,width:300,height:100},{x:200,y:800,width:100,height:400}]},"01":{originalSize:{width:2560,height:1940},size:{width:2048,height:1552},walls:[],obstacles:[]}}),Rt(this,Xt,{}),Ht(qt,this,Kt).call(this)},(e=[{key:"getMap",value:function(t){return Dt(Xt,this)[t]}}])&&zt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Kt(){var t=Dt(Yt,this);for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var i=t[e],n=i.size,o=n.width,r=n.height,a=i.walls;Dt(Xt,this)[e]=new At(o,r,a.map((function(t){var e=t.x,i=t.y,n=t.width,o=t.height,r=t.color;return new kt({location:{x:e,y:i},display:{width:n,height:o,color:r}})})))}}const Gt=function(t){return(t%360+360)%360};function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Jt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nt(n.key),n)}}function Nt(t){var e=function(t){if("object"!=Ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Ut(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}function Qt(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function Vt(t,e,i){return t.set($t(t,e),i),i}function Zt(t,e){return t.get($t(t,e))}function $t(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var _t=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ne=new WeakMap,oe=new WeakMap,re=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qt(this,_t,{x:0,y:0}),Qt(this,te,{radius:80,rotate:0,headRotate:0,width:160,height:160}),Qt(this,ee,{headImage:void 0,bodyImage:void 0,bulletImage:void 0,collisionImage:null}),Qt(this,ie,{hp:0,atk:0,pen:0,armor:0,speed:0,bulletRange:0,bulletSpeed:0}),Qt(this,ne,{}),Qt(this,oe,Date.now())},e=[{key:"x",get:function(){return Zt(_t,this).x},set:function(t){Zt(_t,this).x=t}},{key:"y",get:function(){return Zt(_t,this).y},set:function(t){Zt(_t,this).y=t}},{key:"radius",get:function(){return Zt(te,this).radius}},{key:"speed",get:function(){return Zt(ie,this).speed}},{key:"bulletImage",get:function(){return Zt(ee,this).bulletImage}},{key:"collisionImage",get:function(){return Zt(ee,this).collisionImage}},{key:"rotate",get:function(){return Zt(te,this).rotate},set:function(t){Zt(te,this).rotate=t}},{key:"headRotate",get:function(){return Zt(te,this).headRotate},set:function(t){Zt(te,this).headRotate=t}},{key:"setKeyPressedState",value:function(t,e){Zt(ne,this)[t]=e}},{key:"withLocation",value:function(t,e){return Vt(_t,this,{x:t,y:e}),this}},{key:"withDisplay",value:function(t,e,i){return Vt(te,this,{radius:t,rotate:e,headRotate:i}),Zt(te,this).width=2*t,Zt(te,this).height=2*t,this}},{key:"withTankImage",value:function(t){var e=t.headImage,i=t.bodyImage,n=t.bulletImage,o=t.collisionImage;return Vt(ee,this,{headImage:e,bodyImage:i,bulletImage:n,collisionImage:o}),this}},{key:"withStats",value:function(t){var e=t.hp,i=t.atk,n=t.pen,o=t.armor,r=t.speed,a=t.bulletRange,s=t.bulletSpeed;return Vt(ie,this,{hp:e,atk:i,pen:n,armor:o,speed:r,bulletRange:a,bulletSpeed:s}),this}},{key:"move",value:function(t){var e=Date.now(),i=Zt(ie,this).speed,n=Zt(ne,this);Vt(oe,this,e);var o=0,r=0;(n.w||n.ArrowUp)&&(r-=1),(n.a||n.ArrowLeft)&&(o-=1),(n.s||n.ArrowDown)&&(r+=1),(n.d||n.ArrowRight)&&(o+=1);var a=Math.sqrt(o*o+r*r);if(0!==a){o=o/a*i*.024,r=r/a*i*.024;var s=Math.atan2(r,o)*(180/Math.PI),h=i/16,u=Gt(s-Zt(te,this).rotate);u>180?u-=360:u<-180&&(u+=360),Math.abs(u)<h?Zt(te,this).rotate=s:Zt(te,this).rotate+=h*Math.sign(u),Zt(te,this).rotate=Gt(Zt(te,this).rotate)}this.x+=o,this.y+=r,t.update(this.x,this.y)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Zt(_t,this),n=i.x,o=i.y,r=Zt(te,this),a=r.radius,s=r.width,h=r.height,u=r.rotate,l=r.headRotate,c=Zt(ee,this),f=c.headImage,y=c.bodyImage;t.save(),t.translate(n,o),t.rotate(u*Math.PI/180),t.shadowOffsetX=0,90===Gt(u)?t.shadowOffsetY=-12:t.shadowOffsetY=10,t.shadowBlur=10,t.shadowColor="rgba(0, 0, 0, 0.4)",t.drawImage(y,-s/2,-h/2,s,h),t.restore(),t.save(),t.translate(n,o),t.rotate(l),t.drawImage(f,-s/2,-h/2,s,h),t.restore(),e&&(t.save(),t.translate(n,o),t.strokeStyle="white",t.beginPath(),t.arc(0,0,a,0,2*Math.PI),t.stroke(),t.restore())}}],e&&Jt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function se(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,he(n.key),n)}}function he(t){var e=function(t){if("object"!=ae(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ae(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ae(e)?e:e+""}function ue(t,e,i){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,i)}function le(t,e){return t.get(fe(t,e))}function ce(t,e,i){return t.set(fe(t,e),i),i}function fe(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var ye=new WeakMap,pe=new WeakMap,me=new WeakMap,de=new WeakMap,ve=new WeakMap,we=new WeakMap,ge=new WeakMap,be=new WeakMap,ke=new WeakMap,Se=new WeakMap,xe=function(){return t=function t(){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),ue(this,ye,void 0),ue(this,pe,void 0),ue(this,me,void 0),ue(this,de,void 0),ue(this,ve,void 0),ue(this,we,void 0),ue(this,ge,{tanks:{allies:[],enemies:[],player:void 0},bullets:[],collisionEffects:[],map:void 0}),ue(this,be,{drawBorder:!1,gameContainerSize:{widthRatio:1,heightRatio:1}}),ue(this,ke,{drawMap:function(){},drawTanks:function(){var t=le(ge,e).tanks;t.allies.forEach((function(t){return t.draw(le(pe,e),le(be,e).drawBorder)})),t.player.draw(le(pe,e),le(be,e).drawBorder),t.enemies.forEach((function(t){return t.draw(le(pe,e),le(be,e).drawBorder)}))},drawBullet:function(){var t=le(ge,e),i=t.bullets,n=t.tanks,o=t.collisionEffects,r=t.map.walls;i.forEach((function(t,a){t.draw(le(pe,e),le(be,e).drawBorder),n.enemies.some((function(i){return le(Se,e).isBulletAndTankCollision(i,t)}))?(console.log("Hit tank detected!"),o.push(new Z(t,200,t.collisionImage)),i.splice(a,1)):r.some((function(i){return le(Se,e).isBulletAndWallCollision(t,i)}))&&(console.log("Hit wall detected!"),o.push(new Z(t,200,t.collisionImage)),i.splice(a,1))}))},drawCollisionEffect:function(){var t=le(ge,e).collisionEffects;t.forEach((function(t){return t.draw(le(pe,e))})),t=t.filter((function(t){return!t.isExpired()}))}}),ue(this,Se,{isBulletAndTankCollision:function(t,e){return function(t,e){for(var i=Math.cos(e.angle),n=Math.sin(e.angle),o=e.width/2,r=e.height/2,a=0,s=[{x:e.x+o*i-r*n,y:e.y+o*n+r*i},{x:e.x-o*i-r*n,y:e.y-o*n+r*i},{x:e.x-o*i+r*n,y:e.y-o*n-r*i},{x:e.x+o*i+r*n,y:e.y+o*n-r*i}];a<s.length;a++){var h=s[a],u=h.x-t.x,l=h.y-t.y;if(u*u+l*l<=t.radius*t.radius)return!0}var c=i*(t.x-e.x)+n*(t.y-e.y)+e.x,f=i*(t.y-e.y)-n*(t.x-e.x)+e.y,y=c-Math.max(e.x-o,Math.min(c,e.x+o)),p=f-Math.max(e.y-r,Math.min(f,e.y+r));return y*y+p*p<=t.radius*t.radius}(t,e)},isBulletAndWallCollision:function(t,e){return function(t,e){for(var i=Math.cos(t.angle),n=Math.sin(t.angle),o=t.width/2,r=t.height/2,a=0,s=[{x:t.x+o*i-r*n,y:t.y+o*n+r*i},{x:t.x-o*i-r*n,y:t.y-o*n+r*i},{x:t.x-o*i+r*n,y:t.y-o*n-r*i},{x:t.x+o*i+r*n,y:t.y+o*n-r*i}];a<s.length;a++){var h=s[a];if(h.x>=e.x&&h.x<=e.x+e.width&&h.y>=e.y&&h.y<=e.y+e.height)return!0}for(var u=0,l=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];u<l.length;u++){var c=l[u],f=i*(c.x-t.x)+n*(c.y-t.y)+t.x,y=-n*(c.x-t.x)+i*(c.y-t.y)+t.y;if(f>=t.x-o&&f<=t.x+o&&y>=t.y-r&&y<=t.y+r)return!0}return!1}(t,e)}}),ce(ye,this,document.createElement("canvas")),ce(pe,this,le(ye,this).getContext("2d")),document.body.appendChild(le(ye,this)),ce(we,this,new Ft),ce(ve,this,new ct({x:0,y:0,width:le(ye,this).width,height:le(ye,this).height})),ce(de,this,new d(le(ye,this),le(pe,this))),ce(me,this,new T(le(de,this))),le(de,this).start(),this.resize(),window.addEventListener("resize",(function(){return e.resize()})),window.addEventListener("scroll",(function(t){return t.preventDefault()})),this.loadAssets()},(e=[{key:"resize",value:function(){var t=le(ye,this).parentElement,e=le(be,this).gameContainerSize,i=e.widthRatio,n=e.heightRatio;le(ye,this).width=t.clientWidth*i,le(ye,this).height=t.clientHeight*n,le(ve,this).setSize(le(ye,this));var o=le(ge,this).tanks;o.player&&le(ve,this).update(o.player.x,o.player.y)}},{key:"loadAssets",value:function(){var t=this;le(me,this).onAllAssetsLoaded((function(){return t.onAllAssetsLoaded()})),le(me,this).loadImage("tank.demo.head","../../assets/tanks/demo/head.png"),le(me,this).loadImage("tank.demo.body","../../assets/tanks/demo/body.png"),le(me,this).loadImage("tank.demo.bullet","../../assets/tanks/demo/bullet.png"),le(me,this).loadImage("tank.demo.collision","../../assets/tanks/demo/collision.png"),le(me,this).loadImage("map.01","../../assets/maps/map-01/1x4R.jpeg")}},{key:"onAllAssetsLoaded",value:function(){var t=this;this.buildGameEnv();var e=le(ge,this).tanks.player;document.addEventListener("keydown",(function(t){e.setKeyPressedState(t.key,!0)})),document.addEventListener("keyup",(function(t){e.setKeyPressedState(t.key,!1)})),le(ye,this).addEventListener("contextmenu",(function(t){return t.preventDefault()})),le(ye,this).addEventListener("mousemove",(function(e){return t.handleMouseMove(e)})),le(ye,this).addEventListener("click",(function(e){return t.handleClick(e)})),le(de,this).complete(),this.resize(),this.draw()}},{key:"buildGameEnv",value:function(){var t=le(ge,this),e=le(me,this),i=(new re).withLocation(200,1e3).withDisplay(80,0,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:170}),n=(new re).withLocation(1e3,700).withDisplay(80,90,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15}),o=(new re).withLocation(990,900).withDisplay(80,40,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15}),r=(new re).withLocation(300,300).withDisplay(80,180).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15});t.map=le(we,this).getMap("01"),le(ve,this).setMapSize(t.map.size),t.tanks.player=i,t.tanks.enemies.push(n,o),t.tanks.allies.push(r),le(ve,this).apply(le(pe,this)),le(ve,this).update(i.x,i.y)}},{key:"handleClick",value:function(t){var e=le(ge,this).tanks,i=le(ye,this).getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top,r=n+le(ve,this).x,a=o+le(ve,this).y,s=r-e.player.x,h=a-e.player.y,u=Math.atan2(h,s);le(ge,this).bullets.push((new J).withLocation(e.player.x,e.player.y).withAngle(u).withSpeed(10).withSize(90,30).withImage(e.player.bulletImage).withCollisionImage(e.player.collisionImage)),le(ve,this).update(e.player.x,e.player.y)}},{key:"handleMouseMove",value:function(t){var e=le(ge,this).tanks,i=le(ye,this).getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top,r=n+le(ve,this).x,a=o+le(ve,this).y,s=r-e.player.x,h=a-e.player.y;e.player.headRotate=Math.atan2(h,s)}},{key:"draw",value:function(){var t=this,e=le(ge,this).map.size,i=e.width,n=e.height,o=le(ye,this),r=o.width,a=o.height;le(pe,this).clearRect(0,0,r,a),le(pe,this).save(),le(ve,this).apply(le(pe,this)),le(pe,this).drawImage(le(me,this).getImage("map.01"),0,0,i,n),le(ke,this).drawTanks(),le(ke,this).drawMap(),le(ke,this).drawBullet(),le(ke,this).drawCollisionEffect(),le(ge,this).tanks.player.move(le(ve,this)),le(pe,this).restore(),requestAnimationFrame((function(){return t.draw()}))}}])&&se(t.prototype,e),i&&se(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ie(){var t=new xe;console.log(t)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ie):Ie()})();
//# sourceMappingURL=bundle.js.map