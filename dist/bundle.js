(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function n(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function i(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function r(t,e){return t.get(a(t,e))}function o(t,e,n){return t.set(a(t,e),n),n}function a(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var s=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,d=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,s,void 0),i(this,h,void 0),i(this,l,void 0),i(this,u,void 0),i(this,c,void 0),i(this,f,void 0),i(this,y,void 0),i(this,p,void 0),i(this,m,void 0),o(s,this,e),o(h,this,n),o(l,this,void 0),o(u,this,0),o(c,this,0),o(f,this,!1),o(y,this,0),o(p,this,0),o(m,this,"...")},(n=[{key:"setAssetsLoadedCount",value:function(t){o(p,this,t)}},{key:"setAssetsLimitCount",value:function(t){o(y,this,t)}},{key:"setLoadedAssetsText",value:function(t){o(m,this,t)}},{key:"complete",value:function(){var t=this;o(f,this,!0),setTimeout((function(){return t.stop()}),500)}},{key:"start",value:function(){var t=this,e=Array(parseInt(r(c,this))).fill(".").join(""),n="Đang tải".concat(e),i=r(s,this),a=i.width,d=i.height;r(c,this)>4&&o(c,this,0),o(c,this,r(c,this)+.1),r(h,this).fillStyle="rgb(0, 0, 0)",r(h,this).fillRect(0,0,a,d),r(h,this).save(),r(h,this).translate(a/2,d/2+70),r(h,this).rotate(r(u,this));for(var v=0;v<16;v++)r(h,this).beginPath(),r(h,this).rotate(2*Math.PI/16),r(h,this).moveTo(12,0),r(h,this).lineTo(30,0),r(h,this).lineWidth=2,r(h,this).strokeStyle="rgba(255, 255, 255, ".concat(v/16,")"),r(h,this).stroke();r(h,this).restore(),r(h,this).font="35px Arial",r(h,this).textAlign="center",r(h,this).textBaseline="middle",r(h,this).fillStyle="white",r(h,this).fillText(n,a/2,d/2),r(h,this).font="20px Arial",r(h,this).textAlign="right",r(h,this).textBaseline="bottom",r(h,this).fillStyle="white",r(h,this).fillText(r(f,this)?"Tải hoàn tất":"Đã tải: ".concat(r(m,this)," (").concat(r(p,this),"/").concat(r(y,this),")"),.97*a,.97*d),o(u,this,r(u,this)+.04),o(l,this,requestAnimationFrame((function(){return t.start()})))}},{key:"stop",value:function(){var t=r(s,this),e=t.width,n=t.height;cancelAnimationFrame(r(l,this)),r(h,this).clearRect(0,0,e,n)}}])&&e(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,w(i.key),i)}}function w(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}function b(t,e,n){k(t,e),e.set(t,n)}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(t,e,n){return t.set(M(t,e),n),n}function x(t,e){return t.get(M(t,e))}function M(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var I=new WeakMap,P=new WeakMap,T=new WeakMap,E=new WeakMap,j=new WeakSet,W=function(){return t=function t(e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,n=j),n.add(this),b(this,I,{images:{},json:{}}),b(this,P,0),b(this,T,0),b(this,E,void 0),this.assetLoadingInterface=e},(e=[{key:"loadImage",value:function(t,e){var n,i=this;S(P,this,(n=x(P,this),++n)),this.assetLoadingInterface.setAssetsLimitCount(x(P,this));var r=new Image;r.src=e,r.onload=function(){return M(j,i,A).call(i,t,r)}}},{key:"loadJson",value:function(t,e){var n,i=this;S(P,this,(n=x(P,this),++n)),this.assetLoadingInterface.setAssetsLimitCount(x(P,this)),fetch(e).then((function(t){return t.json()})).then((function(e){return M(j,i,C).call(i,t,e)})).catch((function(t){return console.error("Lỗi tải JSON từ ".concat(e,":"),t)}))}},{key:"getImage",value:function(t){var e=x(I,this).images[t];return e||console.warn('Hình ảnh với tên "'.concat(t,'" không tồn tại')),e}},{key:"getJson",value:function(t){var e=x(I,this).json[t];return e||console.warn('JSON với tên "'.concat(t,'" không tồn tại')),e}},{key:"onAllAssetsLoaded",value:function(t){S(E,this,t)}}])&&g(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function A(t,e){x(I,this).images[t]&&console.warn('Hình ảnh với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),x(I,this).images[t]=e,M(j,this,R).call(this,t)}function C(t,e){x(I,this).json[t]&&console.warn('JSON với tên "'.concat(t,'" đã được thêm vào từ trước. Bạn thêm lại sẽ ghi đè lên nó.')),x(I,this).json[t]=e,M(j,this,R).call(this,t)}function R(t){var e;S(T,this,(e=x(T,this),++e)),this.assetLoadingInterface.setLoadedAssetsText(t),this.assetLoadingInterface.setAssetsLoadedCount(x(T,this)),x(T,this)===x(P,this)&&x(E,this)&&x(E,this).call(this)}function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function H(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,z(i.key),i)}}function z(t){var e=function(t){if("object"!=L(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}function O(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function B(t,e){return t.get(q(t,e))}function D(t,e,n){return t.set(q(t,e),n),n}function q(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var F=new WeakMap,X=new WeakMap,Y=new WeakMap,J=new WeakMap,G=new WeakMap,K=new WeakMap,N=new WeakMap,U=new WeakMap,$=new WeakMap,Q=new WeakMap,V=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),O(this,F,0),O(this,X,0),O(this,Y,0),O(this,J,15),O(this,G,336),O(this,K,90),O(this,N,30),O(this,U,null),O(this,$,null),O(this,Q,0)},e=[{key:"withLocation",value:function(t,e){return D(F,this,t),D(X,this,e),this}},{key:"withAngle",value:function(t){return D(Y,this,t),this}},{key:"withSpeed",value:function(t){return D(J,this,t),this}},{key:"withRange",value:function(t){return D(G,this,t),this}},{key:"withSize",value:function(t,e){return D(K,this,t),D(N,this,e),this}},{key:"withImage",value:function(t){return D(U,this,t),this}},{key:"withCollisionImage",value:function(t){return D($,this,t),this}},{key:"x",get:function(){return B(F,this)}},{key:"y",get:function(){return B(X,this)}},{key:"angle",get:function(){return B(Y,this)}},{key:"speed",get:function(){return B(J,this)}},{key:"width",get:function(){return B(K,this)}},{key:"height",get:function(){return B(N,this)}},{key:"image",get:function(){return B(U,this)}},{key:"collisionImage",get:function(){return B($,this)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return D(F,this,B(F,this)+Math.cos(B(Y,this))*B(J,this)),D(X,this,B(X,this)+Math.sin(B(Y,this))*B(J,this)),D(Q,this,B(Q,this)+B(J,this)),t.save(),t.translate(B(F,this),B(X,this)),t.rotate(B(Y,this)),t.drawImage(B(U,this),-B(K,this)/2,-B(N,this)/2,B(K,this),B(N,this)),t.restore(),e&&(t.save(),t.translate(B(F,this),B(X,this)),t.rotate(B(Y,this)),t.strokeStyle="blue",t.strokeRect(-B(K,this)/2,-B(N,this)/2,B(K,this),B(N,this)),t.restore()),B(Q,this)>=B(G,this)+B(K,this)/2}}],e&&H(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,tt(i.key),i)}}function tt(t){var e=function(t){if("object"!=Z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z(e)?e:e+""}var et=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.duration=n,this.startTime=Date.now(),this.image=i,this.maxWidth=r,this.maxHeight=o,this.radius=10,this.calculateCollisionPoint(e)},(e=[{key:"calculateCollisionPoint",value:function(t){var e=t.angle,n=t.width/2,i=t.height/2,r=Math.cos(e)*n,o=Math.sin(e)*i;this.collisionX=t.x+r,this.collisionY=t.y+o}},{key:"isExpired",value:function(){return Date.now()-this.startTime>this.duration}},{key:"draw",value:function(t){if(!this.isExpired()){var e,n=(Date.now()-this.startTime)/this.duration,i=1+.5*n;if(e=n<=.45?1:1-(n-.45)/.55,t.save(),t.globalAlpha=e,t.translate(this.collisionX,this.collisionY),t.scale(i,i),t.translate(-this.collisionX,-this.collisionY),this.image){var r=this.image.width/this.image.height,o=this.image.width,a=this.image.height;o>this.maxWidth&&(a=(o=this.maxWidth)/r),a>this.maxHeight&&(o=(a=this.maxHeight)*r),t.drawImage(this.image,this.collisionX-o/2,this.collisionY-a/2,o,a)}else t.fillStyle="red",t.beginPath(),t.arc(this.collisionX,this.collisionY,this.radius,0,2*Math.PI),t.fill();t.restore()}}}])&&_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function it(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,rt(i.key),i)}}function rt(t){var e=function(t){if("object"!=nt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nt(e)?e:e+""}function ot(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function at(t,e){return t.get(ht(t,e))}function st(t,e,n){return t.set(ht(t,e),n),n}function ht(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var lt=new WeakMap,ut=new WeakMap,ct=new WeakMap,ft=new WeakMap,yt=new WeakMap,pt=new WeakMap,mt=function(){return t=function t(e){var n=e.x,i=e.y,r=e.width,o=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ot(this,lt,void 0),ot(this,ut,void 0),ot(this,ct,void 0),ot(this,ft,void 0),ot(this,yt,void 0),ot(this,pt,void 0),st(lt,this,n),st(ut,this,i),st(ct,this,r),st(ft,this,o)},(e=[{key:"x",get:function(){return at(lt,this)}},{key:"y",get:function(){return at(ut,this)}},{key:"width",get:function(){return at(ct,this)}},{key:"height",get:function(){return at(ft,this)}},{key:"mapWidth",get:function(){return at(yt,this)}},{key:"mapHeight",get:function(){return at(pt,this)}},{key:"setSize",value:function(t){var e=t.width,n=t.height;st(ct,this,e),st(ft,this,n)}},{key:"setMapSize",value:function(t){var e=t.width,n=t.height;st(yt,this,e),st(pt,this,n)}},{key:"update",value:function(t,e){st(lt,this,t-at(ct,this)/2),st(ut,this,e-at(ft,this)/2),this.clamp()}},{key:"apply",value:function(t){t.translate(-at(lt,this),-at(ut,this))}},{key:"clamp",value:function(){st(lt,this,Math.max(0,Math.min(at(lt,this),at(yt,this)-at(ct,this)))),st(ut,this,Math.max(0,Math.min(at(ut,this),at(pt,this)-at(ft,this))))}}])&&it(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dt(t){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(t)}function vt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,gt(i.key),i)}}function gt(t){var e=function(t){if("object"!=dt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dt(e)?e:e+""}function wt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function bt(t,e){return t.get(St(t,e))}function kt(t,e,n){return t.set(St(t,e),n),n}function St(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var xt=new WeakMap,Mt=new WeakMap,It=function(){return t=function t(e){var n=e.location,i=n.x,r=n.y,o=e.display,a=o.width,s=o.height,h=o.color;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,xt,void 0),wt(this,Mt,void 0),kt(xt,this,{x:i,y:r}),kt(Mt,this,{width:a,height:s,color:null!=h?h:"black"})},(e=[{key:"x",get:function(){return bt(xt,this).x}},{key:"y",get:function(){return bt(xt,this).y}},{key:"width",get:function(){return bt(Mt,this).width}},{key:"height",get:function(){return bt(Mt,this).height}},{key:"draw",value:function(t){var e=bt(xt,this),n=e.x,i=e.y,r=bt(Mt,this),o=r.width,a=r.height,s=r.color;t.save(),t.fillStyle=s,t.fillRect(n,i,o,a),t.restore()}}])&&vt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function Tt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Et(i.key),i)}}function Et(t){var e=function(t){if("object"!=Pt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Pt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pt(e)?e:e+""}function jt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function Wt(t,e,n){return t.set(Ct(t,e),n),n}function At(t,e){return t.get(Ct(t,e))}function Ct(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Rt=new WeakMap,Lt=new WeakMap,Ht=new WeakMap,zt=function(){return t=function t(e,n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),jt(this,Rt,{width:0,height:0}),jt(this,Lt,void 0),jt(this,Ht,[]),Object.assign(At(Rt,this),{width:e,height:n}),Wt(Ht,this,i),Wt(Lt,this,r)},(e=[{key:"walls",get:function(){return At(Ht,this)}},{key:"size",get:function(){return At(Rt,this)}},{key:"backgroundImage",get:function(){return At(Lt,this)}},{key:"draw",value:function(t){At(Ht,this).forEach((function(e){return e.draw(t)}))}}])&&Tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function Bt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Dt(i.key),i)}}function Dt(t){var e=function(t){if("object"!=Ot(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ot(e)?e:e+""}function qt(t,e,n){Ft(t,e),e.set(t,n)}function Ft(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Xt(t,e){return t.get(Yt(t,e))}function Yt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Jt=new WeakMap,Gt=new WeakMap,Kt=new WeakSet,Nt=function(){return t=function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ft(this,e=Kt),e.add(this),qt(this,Jt,{"Demo map":{size:{width:2e3,height:2e3},walls:[{x:500,y:500,width:100,height:300},{x:800,y:200,width:200,height:100},{x:1e3,y:700,width:300,height:100},{x:200,y:800,width:100,height:400}]},"01":{originalSize:{width:2560,height:1940},size:{width:2560/1.2,height:1940/1.2},walls:[],obstacles:[]}}),qt(this,Gt,{}),Yt(Kt,this,Ut).call(this)},(e=[{key:"getMap",value:function(t){return Xt(Gt,this)[t]}}])&&Bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Ut(){var t=Xt(Jt,this);for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e],i=n.size,r=i.width,o=i.height,a=n.walls;Xt(Gt,this)[e]=new zt(r,o,a.map((function(t){var e=t.x,n=t.y,i=t.width,r=t.height,o=t.color;return new It({location:{x:e,y:n},display:{width:i,height:r,color:o}})})))}}const $t=function(t){return t*Math.PI/180},Qt=function(t){return(t%360+360)%360};function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function te(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ne(i.key),i)}}function ee(t,e,n){return e&&te(t.prototype,e),n&&te(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ne(t){var e=function(t){if("object"!=Vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vt(e)?e:e+""}function ie(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function re(t,e,n){return t.set(ae(t,e),n),n}function oe(t,e){return t.get(ae(t,e))}function ae(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var se=new WeakMap,he=new WeakMap,le=new WeakMap,ue=new WeakMap,ce=new WeakMap,fe=new WeakMap,ye=new WeakMap,pe=new WeakMap,me=new WeakMap,de=function(){return ee((function t(){var e,n,i;_t(this,t),ie(this,se,!1),ie(this,he,{x:0,y:0}),ie(this,le,!1),ie(this,ue,{radius:75,rotate:0,headRotate:0,width:150,height:150}),ie(this,ce,{headImage:void 0,bodyImage:void 0,bulletImage:void 0,collisionImage:null}),ie(this,fe,{hp:0,maxHp:0,atk:0,pen:0,armor:0,speed:0,attackSpeed:0,bulletRange:0,bulletSpeed:0}),ie(this,ye,{}),ie(this,pe,[]),ie(this,me,0),e=this,i=void 0,(n=ne(n="shootType"))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i}),[{key:"dead",get:function(){return oe(se,this)},set:function(t){re(se,this,t),oe(se,this)||this.revive()}},{key:"currentHp",get:function(){return oe(fe,this).hp},set:function(t){var e=this,n=t-oe(fe,this).hp,i=this.x,r=this.y;if(0!==n){var o=(n>0?"+":"")+n,a=n>0?"rgb(0, 180, 0)":"rgb(255, 0, 0)",s=Math.PI/4+Math.random()*Math.PI/2;oe(pe,this).push(new ve(o,a,i,r,s,.155*oe(ue,this).height))}oe(fe,this).hp=t,this.currentHp<=0&&(re(se,this,!0),setTimeout((function(){return e.revive()}),3e3))}},{key:"maxHp",get:function(){return oe(fe,this).maxHp},set:function(t){oe(fe,this).maxHp=t}},{key:"x",get:function(){return oe(he,this).x},set:function(t){oe(he,this).x=t}},{key:"y",get:function(){return oe(he,this).y},set:function(t){oe(he,this).y=t}},{key:"radius",get:function(){return oe(ue,this).radius}},{key:"speed",get:function(){return oe(fe,this).speed}},{key:"bulletImage",get:function(){return oe(ce,this).bulletImage}},{key:"collisionImage",get:function(){return oe(ce,this).collisionImage}},{key:"rotate",get:function(){return oe(ue,this).rotate},set:function(t){oe(ue,this).rotate=t}},{key:"headRotate",get:function(){return oe(ue,this).headRotate},set:function(t){oe(ue,this).headRotate=t}},{key:"bulletRange",get:function(){return oe(fe,this).bulletRange}},{key:"bulletSpeed",get:function(){return oe(fe,this).bulletSpeed}},{key:"attackSpeed",get:function(){return oe(fe,this).attackSpeed},set:function(t){oe(fe,this).attackSpeed=t}},{key:"lastShotTime",get:function(){return oe(me,this)},set:function(t){re(me,this,t)}},{key:"atk",get:function(){return oe(fe,this).atk}},{key:"autoShoot",get:function(){return oe(le,this)},set:function(t){re(le,this,t)}},{key:"setKeyPressedState",value:function(t,e){oe(ye,this)[t]=e}},{key:"withLocation",value:function(t,e){return re(he,this,{x:t,y:e}),this}},{key:"withDisplay",value:function(t,e,n){return re(ue,this,{radius:t,rotate:e,headRotate:n}),oe(ue,this).width=2*t,oe(ue,this).height=2*t,this}},{key:"withTankImage",value:function(t){var e=t.headImage,n=t.bodyImage,i=t.bulletImage,r=t.collisionImage;return re(ce,this,{headImage:e,bodyImage:n,bulletImage:i,collisionImage:r}),this}},{key:"withStats",value:function(t){var e=t.hp,n=t.atk,i=t.pen,r=t.armor,o=t.speed,a=t.attackSpeed,s=t.bulletRange,h=t.bulletSpeed;return re(fe,this,{hp:e,maxHp:e,atk:n,pen:i,armor:r,speed:o,attackSpeed:a,bulletRange:s,bulletSpeed:h}),this}},{key:"revive",value:function(){re(se,this,!1),oe(fe,this).hp=oe(fe,this).maxHp}},{key:"heal",value:function(t){this.currentHp+=Math.min(this.maxHp-this.currentHp,parseInt(t))}},{key:"move",value:function(t){var e=oe(fe,this).speed,n=oe(ye,this),i=0,r=0;(n.w||n.ArrowUp)&&(r-=1),(n.a||n.ArrowLeft)&&(i-=1),(n.s||n.ArrowDown)&&(r+=1),(n.d||n.ArrowRight)&&(i+=1);var o=Math.sqrt(i*i+r*r);if(0!==o){i=i/o*e*.024,r=r/o*e*.024;var a=Math.atan2(r,i)*(180/Math.PI),s=e/15,h=Qt(a-oe(ue,this).rotate);h>180?h-=360:h<-180&&(h+=360),Math.abs(h)<s?oe(ue,this).rotate=a:oe(ue,this).rotate+=s*Math.sign(h),oe(ue,this).rotate=Qt(oe(ue,this).rotate)}this.x+=i,this.y+=r,t.update(this.x,this.y)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=oe(he,this),i=n.x,r=n.y,o=oe(ue,this),a=o.radius,s=o.width,h=o.height,l=o.rotate,u=o.headRotate,c=oe(ce,this),f=c.headImage,y=c.bodyImage;t.save(),t.translate(i,r),t.rotate($t(l)),t.shadowOffsetX=0,t.shadowOffsetY=90===Qt(l)?-12:10,t.shadowBlur=14,t.shadowColor="rgba(0, 0, 0, 0.6)",t.drawImage(y,-s/2,-h/2,s,h),t.restore(),t.save(),t.translate(i,r),t.rotate(u),t.drawImage(f,-s/2,-h/2,s,h),t.restore(),re(pe,this,oe(pe,this).filter((function(e){var n=e.update();return e.draw(t),!n}))),e&&(t.save(),t.translate(i,r),t.strokeStyle="white",t.beginPath(),t.arc(0,0,a,0,2*Math.PI),t.stroke(),t.restore())}},{key:"drawHPBar",value:function(t,e,n){var i=oe(he,this),r=i.x,o=i.y,a=oe(ue,this),s=a.width,h=a.height,l=oe(fe,this),u=l.hp,c=l.maxHp,f=.7*s,y=.1*h,p=r-f/2,m=o+this.radius+10,d=u/c*f;t.save(),t.beginPath(),t.strokeStyle="#666",t.lineWidth=2,t.roundRect(p-1,m-1,f+2,y+2,4),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(0, 0, 0, .5)",t.lineWidth=1,t.roundRect(p,m,f,y,4),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(0, 0, 0, .9)",t.lineWidth=1,t.roundRect(p-2.5,m-2.5,f+5,y+5,4),t.stroke(),t.closePath();var v=t.createLinearGradient(p,m,p,m+y);v.addColorStop(0,"rgba(0, 0, 0, .5)"),v.addColorStop(.5,"rgba(0, 0, 0, .5)"),v.addColorStop(1,this.darkenColor("rgba(0, 0, 0, .5)",.5)),t.fillStyle=v,t.beginPath(),t.roundRect(p+.5,m+.5,f-1,y-1,0),t.fill(),t.closePath();var g=t.createLinearGradient(p,m,p,m+y);g.addColorStop(0,e),g.addColorStop(.5,e),g.addColorStop(1,this.darkenColor(e,.5)),t.fillStyle=g;for(var w=0;w<9;w++)t.beginPath(),t.roundRect(p+.5,m+.5,d-1,y-1,0),t.fill(),t.closePath();if(c<7501)for(var b=0;b<9;b++){t.strokeStyle="black";for(var k=f/(c/500),S=1;S<c/500;S++){var x=p+S*k;t.beginPath(),t.moveTo(x,m),t.lineTo(x,m+y-.4*y),t.stroke()}}for(var M=0;M<9;M++){t.fillStyle=e,t.font="Bold ".concat(.155*h,'px "Montserrat", sans-serif'),t.textAlign="center",t.textBaseline="top";var I=m+y+10;t.fillText(n,r,I)}t.restore()}},{key:"darkenColor",value:function(t,e){var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],h=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;h=!1}else for(;!(h=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);h=!0);}catch(t){l=!0,r=t}finally{try{if(!h&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Zt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.match(/\d+/g).map(Number),3),i=n[0],r=n[1],o=n[2];return"rgb(".concat(Math.max(i-255*e,0),", ").concat(Math.max(r-255*e,0),", ").concat(Math.max(o-255*e,0),")")}}])}(),ve=function(){return ee((function t(e,n,i,r,o,a){_t(this,t),this.value=e,this.color=n,this.x=i,this.y=r,this.angle=o,this.fontSize=a,this.speed=2.75,this.duration=400,this.startTime=Date.now()}),[{key:"update",value:function(){var t=Date.now()-this.startTime;return t/this.duration<.6&&(this.x-=Math.cos(this.angle)*this.speed,this.y-=Math.sin(this.angle)*this.speed),t>this.duration}},{key:"draw",value:function(t){for(var e=0;e<9;e++)t.save(),t.globalAlpha=this.opacity,t.fillStyle=this.color,t.font="".concat(this.fontSize,'px "Montserrat", sans-serif'),t.textAlign="center",t.fillText(this.value,this.x,this.y),t.restore()}}])}();function ge(t){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ge(t)}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function be(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ke(i.key),i)}}function ke(t){var e=function(t){if("object"!=ge(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ge(e)?e:e+""}function Se(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function xe(t,e){return t.get(Ie(t,e))}function Me(t,e,n){return t.set(Ie(t,e),n),n}function Ie(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Pe=new WeakMap,Te=new WeakMap,Ee=new WeakMap,je=new WeakMap,We=new WeakMap,Ae=new WeakMap,Ce=new WeakMap,Re=new WeakMap,Le=new WeakMap,He=new WeakMap,ze=new WeakMap,Oe=function(){return t=function t(){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),Se(this,Pe,void 0),Se(this,Te,void 0),Se(this,Ee,void 0),Se(this,je,void 0),Se(this,We,void 0),Se(this,Ae,void 0),Se(this,Ce,{clientX:0,clientY:0}),Se(this,Re,{tanks:{allies:[],enemies:[],player:void 0},bullets:[],collisionEffects:[],map:void 0}),Se(this,Le,{drawBorder:!1,log:!0,gameContainerSize:{widthRatio:1,heightRatio:1}}),Se(this,He,{drawMap:function(){},drawTanks:function(){var t=xe(Re,e).tanks;t.allies.forEach((function(t,n){t.dead||(t.drawHPBar(xe(Te,e),"rgb(60, 150, 255)","Ally ".concat(n+1)),t.draw(xe(Te,e),xe(Le,e).drawBorder))})),t.enemies.forEach((function(t,n){t.dead||(t.drawHPBar(xe(Te,e),"rgb(255, 0, 0)","Enemy ".concat(n+1)),t.draw(xe(Te,e),xe(Le,e).drawBorder))})),t.player.dead||(t.player.drawHPBar(xe(Te,e),"rgb(0, 180, 0)","Player"),t.player.draw(xe(Te,e),xe(Le,e).drawBorder)),t.player.autoShoot&&e.playerShoot(xe(Ce,e),t.player.shootType)},drawBullet:function(){var t=xe(Re,e),n=t.bullets,i=t.tanks,r=t.collisionEffects,o=t.map.walls,a=t.map;n.forEach((function(t,s){t.draw(xe(Te,e),xe(Le,e).drawBorder)?n.splice(s,1):(i.enemies.forEach((function(o){!o.dead&&xe(ze,e).isBulletAndTankCollision(o,t)&&(xe(Le,e).log&&console.log("Hit tank detected!"),r.push(new et(t,200,t.collisionImage)),n.splice(s,1),o.currentHp-=i.player.atk,Math.random()<.25&&o.heal(.1*(o.maxHp-o.currentHp)),i.player.currentHp-=parseInt(.15*i.player.atk),Math.random()<.25&&i.player.heal(.1*(i.player.maxHp-i.player.currentHp)))})),o.some((function(n){return xe(ze,e).isBulletAndWallCollision(t,n)}))?(xe(Le,e).log&&console.log("Hit wall detected!"),r.push(new et(t,200,t.collisionImage)),n.splice(s,1)):(t.x<0||t.x>a.size.width||t.y<0||t.y>a.size.height)&&(xe(Le,e).log&&console.log("Bullet out of map, remove"),n.splice(s,1)))}))},drawCollisionEffect:function(){var t=xe(Re,e).collisionEffects;t.forEach((function(t){return t.draw(xe(Te,e))})),t=t.filter((function(t){return!t.isExpired()}))}}),Se(this,ze,{isBulletAndTankCollision:function(t,e){return function(t,e){for(var n=Math.cos(e.angle),i=Math.sin(e.angle),r=e.width/2,o=e.height/2,a=0,s=[{x:e.x+r*n-o*i,y:e.y+r*i+o*n},{x:e.x-r*n-o*i,y:e.y-r*i+o*n},{x:e.x-r*n+o*i,y:e.y-r*i-o*n},{x:e.x+r*n+o*i,y:e.y+r*i-o*n}];a<s.length;a++){var h=s[a],l=h.x-t.x,u=h.y-t.y;if(l*l+u*u<=t.radius*t.radius)return!0}var c=n*(t.x-e.x)+i*(t.y-e.y)+e.x,f=n*(t.y-e.y)-i*(t.x-e.x)+e.y,y=c-Math.max(e.x-r,Math.min(c,e.x+r)),p=f-Math.max(e.y-o,Math.min(f,e.y+o));return y*y+p*p<=t.radius*t.radius}(t,e)},isBulletAndWallCollision:function(t,e){return function(t,e){for(var n=Math.cos(t.angle),i=Math.sin(t.angle),r=t.width/2,o=t.height/2,a=0,s=[{x:t.x+r*n-o*i,y:t.y+r*i+o*n},{x:t.x-r*n-o*i,y:t.y-r*i+o*n},{x:t.x-r*n+o*i,y:t.y-r*i-o*n},{x:t.x+r*n+o*i,y:t.y+r*i-o*n}];a<s.length;a++){var h=s[a];if(h.x>=e.x&&h.x<=e.x+e.width&&h.y>=e.y&&h.y<=e.y+e.height)return!0}for(var l=0,u=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];l<u.length;l++){var c=u[l],f=n*(c.x-t.x)+i*(c.y-t.y)+t.x,y=-i*(c.x-t.x)+n*(c.y-t.y)+t.y;if(f>=t.x-r&&f<=t.x+r&&y>=t.y-o&&y<=t.y+o)return!0}return!1}(t,e)}}),Me(Pe,this,document.createElement("canvas")),Me(Te,this,xe(Pe,this).getContext("2d")),document.body.appendChild(xe(Pe,this)),Me(Ae,this,new Nt),Me(We,this,new mt({x:0,y:0,width:xe(Pe,this).width,height:xe(Pe,this).height})),Me(je,this,new d(xe(Pe,this),xe(Te,this))),Me(Ee,this,new W(xe(je,this))),xe(je,this).start(),this.resize(),window.addEventListener("resize",(function(){return e.resize()})),window.addEventListener("scroll",(function(t){return t.preventDefault()})),this.loadAssets()},e=[{key:"resize",value:function(){var t=xe(Pe,this).parentElement,e=xe(Le,this).gameContainerSize,n=e.widthRatio,i=e.heightRatio;xe(Pe,this).width=t.clientWidth*n,xe(Pe,this).height=t.clientHeight*i,xe(We,this).setSize(xe(Pe,this));var r=xe(Re,this).tanks;r.player&&xe(We,this).update(r.player.x,r.player.y)}},{key:"loadAssets",value:function(){var t=this;xe(Ee,this).onAllAssetsLoaded((function(){return t.onAllAssetsLoaded()})),xe(Ee,this).loadImage("tank.demo.head","assets/images/tanks/demo/head.png"),xe(Ee,this).loadImage("tank.demo.body","assets/images/tanks/demo/body.png"),xe(Ee,this).loadImage("tank.demo.bullet","assets/images/tanks/demo/bullet.png"),xe(Ee,this).loadImage("tank.demo.collision","assets/images/tanks/demo/collision.png"),xe(Ee,this).loadImage("map.01","assets/images/maps/map-01/bg.jpeg")}},{key:"onAllAssetsLoaded",value:function(){var t=this;this.buildGameEnv();var e=xe(Re,this).tanks.player;document.addEventListener("keydown",(function(t){e.setKeyPressedState(t.key,!0);var n=void 0,i=void 0;"q"===t.key&&(e.shootType="disperse",clearTimeout(n),n=setTimeout((function(){"disperse"===e.shootType&&(e.shootType="normal")}),8e3))," "===t.key&&(e.currentHp-=parseInt(.5*e.currentHp),e.attackSpeed=180,e.shootType="fiveDisperse",clearTimeout(i),i=setTimeout((function(){e.attackSpeed=120,"fiveDisperse"===e.shootType&&(e.shootType="normal")}),5e3))})),document.addEventListener("keyup",(function(t){e.setKeyPressedState(t.key,!1)})),xe(Pe,this).addEventListener("contextmenu",(function(t){return t.preventDefault()})),xe(Pe,this).addEventListener("mousemove",(function(e){return t.handleMouseMove(e)})),xe(Pe,this).addEventListener("mousedown",(function(t){2===t.button&&(e.autoShoot=!e.autoShoot)})),xe(Pe,this).addEventListener("click",(function(n){return t.playerShoot(n,e.shootType)})),xe(je,this).complete(),this.resize(),this.draw(),setInterval((function(){xe(Re,t).tanks.enemies.forEach((function(t){t.heal(.1*(t.maxHp-t.currentHp))})),xe(Re,t).tanks.player.heal(.1*(xe(Re,t).tanks.player.maxHp-xe(Re,t).tanks.player.currentHp))}),1e3),setInterval((function(){xe(Re,t).collisionEffects=xe(Re,t).collisionEffects.filter((function(t){return!t.isExpired()})),xe(Le,t).log&&console.log("Expired collision effect cleared",xe(Re,t).collisionEffects)}),5e3)}},{key:"buildGameEnv",value:function(){var t=xe(Re,this),e=xe(Ee,this),n=(new de).withLocation(200,1e3).withDisplay(75,0,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:3981,atk:286,pen:20,armor:40,speed:170,attackSpeed:120,bulletRange:480,bulletSpeed:15}),i=(new de).withLocation(1e3,700).withDisplay(75,90,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:9533,atk:186,pen:10,armor:40,speed:15}),r=(new de).withLocation(990,900).withDisplay(75,40,0).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:5981,atk:186,pen:10,armor:40,speed:15}),o=(new de).withLocation(300,300).withDisplay(75,180).withTankImage({headImage:e.getImage("tank.demo.head"),bodyImage:e.getImage("tank.demo.body"),bulletImage:e.getImage("tank.demo.bullet"),collisionImage:e.getImage("tank.demo.collision")}).withStats({hp:2981,atk:186,pen:10,armor:40,speed:15});t.map=xe(Ae,this).getMap("01"),xe(We,this).setMapSize(t.map.size),t.tanks.player=n,t.tanks.enemies.push(i,r),t.tanks.allies.push(o),xe(We,this).apply(xe(Te,this)),xe(We,this).update(n.x,n.y)}},{key:"playerShoot",value:function(t,e){var n,i,r=xe(Re,this).tanks,o=Date.now();if(!(o-r.player.lastShotTime<6e4/r.player.attackSpeed)){r.player.lastShotTime=o;var a=xe(Pe,this).getBoundingClientRect(),s=t.clientX-a.left,h=t.clientY-a.top,l=s+xe(We,this).x,u=h+xe(We,this).y,c=l-r.player.x,f=u-r.player.y,y=Math.atan2(f,c);(n=xe(Re,this).bullets).push.apply(n,function(t){if(Array.isArray(t))return we(t)}(i={normal:[0],disperse:[0,-15,15],fiveDisperse:[0,-10,10,-20,20],sixDisperse:[0,60,-60,120,-120,-180],twelveDisperse:[0,30,-30,60,-60,90,-90,120,-120,150,-150,180]}[null!=e?e:"normal"].map((function(t){return(new V).withLocation(r.player.x,r.player.y).withAngle($t((e=y,e/Math.PI*180+t))).withSpeed(r.player.bulletSpeed).withRange(r.player.bulletRange).withSize(100,100/3).withImage(r.player.bulletImage).withCollisionImage(r.player.collisionImage);var e})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return we(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}},{key:"handleMouseMove",value:function(t){var e=xe(Re,this).tanks,n=xe(Pe,this).getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top,o=i+xe(We,this).x,a=r+xe(We,this).y,s=o-e.player.x,h=a-e.player.y;e.player.headRotate=Math.atan2(h,s),Me(Ce,this,{clientX:i,clientY:r})}},{key:"draw",value:function(){var t=this,e=1e3/120,n=performance.now(),i=function(r){var o=r-n;if(o>e){n=r-o%e;var a=xe(Re,t).map.size,s=a.width,h=a.height,l=xe(Pe,t),u=l.width,c=l.height;xe(Te,t).clearRect(0,0,u,c),xe(Te,t).save(),xe(We,t).apply(xe(Te,t)),xe(Te,t).drawImage(xe(Ee,t).getImage("map.01"),0,0,s,h),xe(He,t).drawTanks(),xe(He,t).drawMap(),xe(He,t).drawBullet(),xe(He,t).drawCollisionEffect(),xe(Re,t).tanks.player.move(xe(We,t)),xe(Te,t).restore()}requestAnimationFrame(i)};i(performance.now())}}],e&&be(t.prototype,e),n&&be(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function Be(t){"development"!=t?document.getElementById("start").addEventListener("click",(function(t){var e,n;t.target.style.display="none",/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&((n=document.querySelector("meta[name=viewport]"))||((n=document.createElement("meta")).name="viewport",document.head.appendChild(n)),n.content="width=device-width, initial-scale=".concat(.4,", maximum-scale=").concat(.4,", user-scalable=no")),(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation&&screen.orientation.lock?screen.orientation.lock("landscape").catch((function(t){console.error("Khóa màn hình ngang thất bại:",t)})):alert("Thiết bị của bạn không hỗ trợ khóa màn hình."),new Oe})):(document.getElementById("start").style.display="none",new Oe)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Be):Be("development")})();